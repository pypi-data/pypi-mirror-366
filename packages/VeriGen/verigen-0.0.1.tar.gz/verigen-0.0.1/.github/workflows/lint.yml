on:
    push:
        branches-ignore:
          - dev
    pull_request:
        branches:
            - main
            - dev

name: Static Analysis and Linting
jobs:
    lint:
        runs-on: ${{ matrix.os }}
        name: ${{ matrix.os }} (${{ matrix.python-version}})

        strategy:
            fail-fast: false
            matrix:
                os: ["ubuntu-latest"]
                python-version: ["3.11"]

        steps:
            - uses: actions/checkout@v4
            - name: Set up Python
              uses: actions/setup-python@v5
              with:
                python-version: ${{ matrix.python-version }}
            - name: Install package
              run: |
                python -m pip install --upgrade pip
                pip install -r requirements.txt
                pip install -r requirements_dev.txt
                pip install .
            - name: Autoflake (Unused Imports)
              run: |
                autoflake --remove-all-unused-imports --in-place -r .
            - name: Run Isort (Import sorting)
              run: |
                isort .
            - name: Run Pylint (Static analysis)
              run: |
                pylint --recursive=y --rcfile=pyproject.toml tests verigen
            - name: Run Black (Code Formatter)
              run: |
                black --diff --color --check --verbose tests verigen
            - name: Git Auto Commit
              uses: stefanzweifel/git-auto-commit-action@v5
              with:
                commit_message: Static Analysis & Linting Changes


    # security:
    #     runs-on: ${{ matrix.os }}
    #     name: ${{ matrix.os }} (${{ matrix.python-version}})

    #     strategy:
    #         fail-fast: false
    #         matrix:
    #             os: ["ubuntu-latest"]
    #             python-version: ["3.11"]
    #     steps:
    #         - name: Checkout repo
    #           uses: actions/checkout@v3
    #         - name: Set up Python
    #           uses: actions/setup-python@v2
    #           with:
    #             python-version: '3.10'
    #         - name: Install dependencies
    #           run: |
    #             python -m pip install --upgrade pip
    #             pip install bandit
    #         - name: Run Bandit (Security Analysis)
    #           run: |
    #             bandit -r .
