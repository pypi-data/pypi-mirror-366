<?xml version="1.0" encoding="UTF-8"?>
<gsl-prompt id="20250802T024329+0000">
<gsl-description>

<!--
Self-contained prompt and spec for OBK/Codex agent work.
This file upgrades the “today” folder logic in the `obk` CLI to synchronize all date-sensitive commands (trace-id, validate-today, harmonize-today) using UTC by default, with optional timezone override. Inputs, outputs, and workflows are outlined below.
-->
</gsl-description>

<gsl-header>

# UTC-Synchronized "Today" Folder Logic for OBK CLI
</gsl-header>

<gsl-block>

<gsl-purpose>

## 1. Purpose

Update the `obk` CLI so that all commands referencing "today" (e.g., `trace-id`, `validate-today`, `harmonize-today`) use a shared, UTC-synchronized folder/date logic. Support an explicit timezone override via CLI option, defaulting to UTC. The goal is to eliminate ambiguity between local time and UTC, ensuring CI, automation, and end-users all reference the same day by default.

</gsl-purpose>

<gsl-inputs>

## 2. Inputs

| Input                                              | Notes                                                                                     |
| -------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| `utc-synchronized-today-logic.md`                  | Reference article describing desired folder/date logic for “today” across all CLI commands |
| `prompt-template-for-codex-agents.md`              | Prompt file structure and section conventions                                             |
| `adhoc-task-template-for-codex-agents.md`          | Ad-hoc Codex prompt conventions and allowed file policies                                 |
| `one-line-manual-tests.md`                         | Best practices for designing concise manual TDD tests                                     |
| Stubbed prompt                         |                                     |

</gsl-inputs>

<gsl-outputs>

## 3. Outputs

- Refactored folder/date logic for “today” in `cli.py`
- CLI commands (`trace-id`, `validate-today`, `harmonize-today`) accepting and defaulting to `--timezone UTC`
- Updated help output for all affected commands
- New/updated manual and automated tests verifying consistent UTC/tz-aware folder selection


</gsl-outputs>

<gsl-workflows>

## 4. Workflows

#### Manual Acceptance Test (when it is close to midnight EST)

##### **1. Check Current Local and UTC Time**

* **Why:** So you know what “today” means in each context.
    
* **How:**
    
    ```bash
    python -c "from datetime import datetime, timezone; print('UTC:', datetime.now(timezone.utc).strftime('%Y-%m-%d %H:%M')); import time; print('Local:', time.strftime('%Y-%m-%d %H:%M'))"
    ```
    
* **What to look for:**
    
    * **UTC** time may be a different day than your local time, especially at night.
        



##### **2. Run CLI Command for Default (UTC) “Today”**

* **Why:** This tests that the CLI is UTC by default.
    
* **How:**
    
    ```bash
    python -m obk trace-id
    ```
    
* **What to look for:**
    
    * The output date (`YYYYMMDDT...`) should match the **current UTC date**.
        



##### **3. Run CLI Command with Local Timezone Override**

* **Why:** To confirm the `--timezone` flag produces local date output.
    
* **How:**
    
    ```bash
    python -m obk trace-id --timezone America/New_York
    ```
    
* **What to look for:**
    
    * The output date (`YYYYMMDDT...`) should match the **current local date in New York**.
        



##### **4. Run “Today” Folder Commands and Check Date Folders**

* **Why:** To verify that the reported folder path aligns with the correct date in both UTC and local time.
    
* **How:**
    
    ```bash
    python -m obk validate-today
    python -m obk validate-today --timezone America/New_York
    python -m obk harmonize-today --dry-run
    python -m obk harmonize-today --dry-run --timezone America/New_York
    ```
    
* **What to look for:**
    
    * The folder reported should be:
        
        * **UTC:** `.../prompts/YYYY/MM/DD` (matches UTC date)
            
        * **New York:** `.../prompts/YYYY/MM/DD` (matches NY local date)
            
    * Confirm that each “today” command reports the **same date/folder** as `trace-id` for the corresponding timezone.
        



##### **5. Compare and Log Results**

* **Why:** Final check that all commands are consistent and match your expectations.
    
* **How:**
    
    * Copy the date segments or folder paths from each output.
        
    * Visually confirm:
        
        * All UTC outputs are the same date/folder.
            
        * All `America/New_York` outputs are the same date/folder.
            
        * The two timezones may differ by one day (if you’re running late at night).
            



##### **6. [Optional] Edge Cases**

* **Try with “exotic” timezones:**
    
    ```bash
    python -m obk trace-id --timezone Pacific/Kiritimati
    ```
    
* **What to look for:**
    
    * Output should reflect the correct day in the specified exotic timezone.
        



#### **Summary Table**

| Step | Command | What Should Happen |
| --- | --- | --- |
| 1 | See above (Python oneliner) | Shows current UTC and Local time |
| 2 | `python -m obk trace-id` | Outputs UTC date |
| 3 | `python -m obk trace-id --timezone America/New_York` | Outputs NY date (may differ from UTC at night) |
| 4 | `validate-today`, `harmonize-today` (both UTC and NY) | Folder paths use correct date for UTC or NY |
| 5 | Compare outputs | UTC outputs match each other, NY outputs match each |
| 6 | `--timezone Pacific/Kiritimati` (optional) | Correct date for exotic timezones |

* * *

</gsl-workflows>

<gsl-tdd>

<gsl-description>

## 5. Tests

<!--
Add single-line manual tests (see `one-line-manual-tests.md`). Each `<gsl-test>` element covers a required behavior or edge case.
-->
</gsl-description>

<gsl-test id="T1">

- T1: <!-- [placeholder] Manual test for default UTC “today” folder selection in `trace-id` and `validate-today` -->
</gsl-test>

<gsl-test id="T2">

- T2: <!-- [placeholder] Manual test for explicit timezone override (e.g., `--timezone America/New_York`) affecting all relevant commands -->
</gsl-test>

<gsl-test id="T3">

- T3: <!-- [placeholder] Edge case: DST transition and rare timezones -->
</gsl-test>

<gsl-test id="T4">

- T4: `obk trace-id` && `obk validate-today`
</gsl-test>

<gsl-test id="T5">

- T5: `obk trace-id --timezone America/New_York` && `obk validate-today --timezone America/New_York`
</gsl-test>

<gsl-test id="T6">

- T6: `obk harmonize-today --timezone Asia/Tokyo`
</gsl-test>

</gsl-tdd>

<gsl-document-spec>

## 6. Document Specification

#### Overview

This section defines the rules and conventions for maintaining and updating this prompt document.
This specification applies only to this prompt document.

#### S-1. Identifier and Numbering

Major sections and tests in this document must use a clear, hierarchical ID. Use an uppercase prefix and numbers, like `T1`, `T2.1`, or `S1.2.3`:

* Use `T` for tests in `<gsl-tdd>` (e.g., `T1`, `T2.1`).
* Use `S` for specification items if needed (e.g., `S1`, `S2.1`).
* Number all items in order, with no gaps or repeats.
* Do not remove or change IDs except to fix errors.

These IDs are required for referencing, tracking, and audits.

#### S-2. Update Policy

These rules apply to automated changes by agents. Manual edits by maintainers can update any section.

* Agents **may only** update these sections:

  * `<gsl-workflows>` (agents may add, change, or remove any part)
  * `<gsl-tdd>` (agents may add new `<gsl-test>` elements, but may not change or remove any existing `<gsl-test>`)
* Agents **must not** change or remove any other content in this document.

These rules protect the integrity of the document and its tests, while allowing agents to add workflows and new tests.

#### S-3. Tests Section

* `<gsl-tdd>` holds one or more `<gsl-test>` elements.
* Each `<gsl-test>` must start with a single-line description and have a unique `id` (e.g., `T1`, `T2`, etc).
* You may add a code block (with triple backticks) below the test description if needed.
* Agents may only add new `<gsl-test>` elements. They must not change or remove any existing test.
* Only maintainers can change or remove tests.
* Use these tests for auditing and validation.

</gsl-document-spec>
</gsl-block>
</gsl-prompt>
