<?xml version="1.0" encoding="UTF-8"?>
<gsl-prompt id="20250731T194500-0400">

<gsl-header>

# Add Prompt Validation, Harmonization, and Trace ID to OBK CLI
</gsl-header>

<gsl-block>

<gsl-purpose>

## 1. Purpose

Implement prompt file validation, harmonization, and trace ID generation as OBK CLI features, closely following the guide on best practices. All commands must fit OBK’s CLI structure and use the provided XSD schema for validation. </gsl-purpose>

<gsl-inputs>

## 2. Inputs

| Input                                    | Notes                                                                                       |
| ---------------------------------------- | ------------------------------------------------------------------------------------------- |
| `prompt-validation-harmonization-guide.md` | Article outlining the design and reference code for validation, harmonization, and trace ID |
| `one-line-manual-tests.md`                | Article on the manual-test-first workflow and TDD best practices                            |
| `gsl-prompt.xsd`                          | OBK’s XML schema for validating prompt files                                                |                      |
| `get\_prompt\_id.py                       | Reference script for the trace ID command (most up-to-date logic`)                           |
| Stubbed prompt `20250731T194500-0400.md`   |                           |
| `do-harmonize-validate-prompt-id.md` Codex Task   |                           |



</gsl-inputs>

<gsl-outputs>

## 3. Outputs

- Completed prompt `20250731T194500-0400.md`
- Added source code and automated tests 
</gsl-outputs>

<gsl-workflows>

## 4. Workflows

#### Trace ID

1. `obk trace-id`
2. `obk trace-id -h`

#### Validate All

1. `obk validate-all`
2. `obk validate-all -h`

#### Validate Today

1. `obk validate-today`
2. `obk validate-today -h`

#### Harmonize All

1. `obk harmonize-all`
2. `obk harmonize-all -h`

#### Harmonize Today

1. `obk harmonize-today`
2. `obk harmonize-all -h`

</gsl-workflows>

<gsl-tdd>
<gsl-description>

## 5. Tests
</gsl-description>

<gsl-test id="T1">

- **PASS** T1: OBK CLI `validate-all` command, when run on a directory of prompt files, validates each file against `gsl-prompt.xsd`. It prints a clear error for every invalid file and exits with nonzero status if any file fails validation; it prints "All prompt files are valid." and exits zero only if all files pass.


    ```powershell
    
    PS C:\Users\LocalAdmin\Documents\repos\obk> obk validate-all
    prompts\07\27\20250727T094740-0400.md: Start tag expected, '<' not found, line 1, column 1 (<string>, line 1)
    
    PS C:\Users\LocalAdmin\Documents\repos\obk> obk validate-all
    All prompt files are valid.
    
    ```

</gsl-test>

<gsl-test id="T2">

- **PASS** T2: OBK CLI `harmonize-all` command, when run, rewrites prompt files so all XML tags are left-justified and blank lines are inserted as required by OBK GSL schema rules. The `--dry-run` option reports planned changes without modifying any files.

</gsl-test>

<gsl-test id="T3">

- **PASS** T3: OBK CLI commands (`validate-all`, `harmonize-all`, and `trace-id`) function correctly when run from any working directory, provided that prompt and schema paths are valid.
</gsl-test>

<gsl-test id="T4">

- **PASS** T4: OBK CLI `trace-id` command generates a prompt ID matching the output and pattern of `get_prompt_id.py` (e.g., `YYYYMMDDTHHMMSS±ZZZZ`), supports a `--timezone` option, and prints a clear error for invalid timezones.

    ```powershell
    PS C:\Users\LocalAdmin\Documents\repos\obk> obk trace-id --timezone America/New_York
    20250731T203955-0400
    
    PS C:\Users\LocalAdmin\Documents\repos\obk> obk trace-id
    20250801T004119+0000
    
    ```
</gsl-test>
<gsl-test id="T5">

* **PASS** T5: OBK CLI `validate-today` only checks prompt files for the current date, reports the number of valid/invalid files, and handles the case where no prompt files exist for today.

  ```powershell
  PS C:\Users\LocalAdmin\Documents\repos\obk> obk validate-today
  Validating today's prompts under: C:\Users\LocalAdmin\Documents\repos\obk\prompts\2025\07\31
  No prompt files found.
  Summary: 0 passed, 0 failed.
  ```

  ```powershell
  PS C:\Users\LocalAdmin\Documents\repos\obk> obk validate-today
  Validating today's prompts under: C:\Users\LocalAdmin\Documents\repos\obk\prompts\2025\07\31
  ❌ Validation errors found in 1 file(s):
    - 20250731T203955-0400.md: Start tag expected, '<' not found, line 1, column 1 (<string>, line 1)
  Summary: 0 passed, 1 failed.
  ```

  ```powershell
  PS C:\Users\LocalAdmin\Documents\repos\obk> obk validate-today
  Validating today's prompts under: C:\Users\LocalAdmin\Documents\repos\obk\prompts\2025\07\31
  ✅ All 2 prompt files for today validated successfully!
  Summary: 2 passed, 0 failed.
  ```

</gsl-test>

<gsl-test id="T6">

* **PASS** T6: OBK CLI `harmonize-today` harmonizes only today’s prompt files, reports the number of files checked/changed, and supports `--dry-run`.

  ```powershell
  PS C:\Users\LocalAdmin\Documents\repos\obk> obk harmonize-today
  Harmonizing TODAY's prompts under: C:\Users\LocalAdmin\Documents\repos\obk\prompts\2025\07\31
  ✔️ Inserted blank after opening tag at line 4 in 20250731T203955-0400.md
  ✔️ Left-justified tag in 20250731T203955-0400.md
  Summary: 1 file(s) harmonized out of 2 checked.
  ```

  ```powershell
  PS C:\Users\LocalAdmin\Documents\repos\obk> obk harmonize-today --dry-run
  Harmonizing TODAY's prompts under: C:\Users\LocalAdmin\Documents\repos\obk\prompts\2025\07\31
  ✔️ Would insert blank after opening tag at line 4 in 20250731T203955-0400.md
  Summary: 0 file(s) harmonized out of 2 checked.
  Dry run: No files were modified.
  ```

</gsl-test>

<gsl-test id="T7">

* **NEW** T7: OBK CLI commands exit with the correct exit code.

  * Zero (0) if all files pass.
  * One (1) if any files fail validation.
  * Two (2) if the `prompts` directory is not found.

  ```powershell
  PS> obk validate-all
  [Exits with code 0 if all pass]
  [Exits with code 1 if any file fails]
  [Exits with code 2 if prompts dir not found]
  ```

</gsl-test>

<gsl-test id="T8">

* **NEW** T8: OBK CLI’s harmonize and validate commands can be run from *any* subdirectory and still correctly locate the project root’s `prompts` directory.

  ```powershell
  PS C:\Users\LocalAdmin\Documents\repos\obk\src\obk> obk validate-all
  Validating ALL prompts under: C:\Users\LocalAdmin\Documents\repos\obk\prompts
  ```

  ```powershell
  PS C:\Users\LocalAdmin\Documents\repos\obk\src\obk> obk harmonize-all
  Harmonizing ALL prompts under: C:\Users\LocalAdmin\Documents\repos\obk\prompts
  ```

</gsl-test>

<gsl-test id="T9">

* **NEW** T9: OBK CLI harmonize and validate commands print a clear summary even if no prompt files are found.

  ```powershell
  PS> obk harmonize-today
  Harmonizing TODAY's prompts under: C:\...\prompts\2025\07\31
  No prompt files found.
  Summary: 0 file(s) harmonized out of 0 checked.
  ```

</gsl-test>

<gsl-test id="T10">

* **NEW** T10: `obk harmonize-all --dry-run` prints a summary, no files are modified, and any actions are prefixed with "Would".

  ```powershell
  PS> obk harmonize-all --dry-run
  Harmonizing ALL prompts under: C:\Users\LocalAdmin\Documents\repos\obk\prompts
  ✔️ Would insert blank after opening tag at line 4 in 20250731T203955-0400.md
  Summary: 1 file(s) would be harmonized out of 3 checked.
  Dry run: No files were modified.
  ```

</gsl-test>

</gsl-tdd>

<gsl-document-spec>

## 6. Document Specification

#### Overview

This section defines the rules and conventions for maintaining and updating this prompt document.
This specification applies only to this prompt document.

#### S-1. Identifier and Numbering

Major sections and tests in this document must use a clear, hierarchical ID. Use an uppercase prefix and numbers, like `T1`, `T2.1`, or `S1.2.3`:

* Use `T` for tests in `<gsl-tdd>` (e.g., `T1`, `T2.1`).
* Use `S` for specification items if needed (e.g., `S1`, `S2.1`).
* Number all items in order, with no gaps or repeats.
* Do not remove or change IDs except to fix errors.

These IDs are required for referencing, tracking, and audits.

#### S-2. Update Policy

These rules apply to automated changes by agents. Manual edits by maintainers can update any section.

* Agents **may only** update these sections:

  * `<gsl-workflows>` (agents may add, change, or remove any part)
  * `<gsl-tdd>` (agents may add new `<gsl-test>` elements, but may not change or remove any existing `<gsl-test>`)
* Agents **must not** change or remove any other content in this document.

These rules protect the integrity of the document and its tests, while allowing agents to add workflows and new tests.

#### S-3. Tests Section

* `<gsl-tdd>` holds one or more `<gsl-test>` elements.
* Each `<gsl-test>` must start with a single-line description and have a unique `id` (e.g., `T1`, `T2`, etc).
* You may add a code block (with triple backticks) below the test description if needed.
* Agents may only add new `<gsl-test>` elements. They must not change or remove any existing test.
* Only maintainers can change or remove tests.
* Use these tests for auditing and validation.

</gsl-document-spec>
</gsl-block>
</gsl-prompt>
