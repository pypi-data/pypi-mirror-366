<?xml version="1.0" encoding="UTF-8"?>
<gsl-prompt id="20250801T153742+0000">

<gsl-description>

<!--
This is a self-contained prompt and spec for OBK/Codex agent work.
- Inputs, outputs, workflows, and tests are listed below.
- All document rules and agent policies are defined in the "Document Specification" section.
- Agents may only update workflows and add new tests (see rules).
- Everything else is for maintainers to edit as needed.
- This file should be easy to read and quick to update—no hidden steps or dependencies.
-->
</gsl-description>

<gsl-header>

# Multi-XSD Prompt Validation with xmlschema and Resource Packaging
</gsl-header>

<gsl-block>

<gsl-purpose>

## 1. Purpose

Implement robust prompt validation in OBK, supporting multiple XSD schemas, package resource loading, and migration to `xmlschema` for modern XML validation.
</gsl-purpose>

<gsl-inputs>

## 2. Inputs

| Input | Notes |
| --- | --- |
| `xsd-upgrade.md` | Feature/design spec for multi-XSD prompt validation |
| `prompt-template-for-codex-agents.md` | Prompt structure and maintenance rules |
| `adhoc-task-template-for-codex-agents.md` | Task structuring and repo modification policy |
| `one-line-manual-tests.md` | Manual test philosophy for initial test cases |
| `20250801T153742+0000.md` | Stubbed prompt (this prompt) |

</gsl-inputs>

<gsl-outputs>

## 3. Outputs

<!-- List main components or deliverables produced by this prompt. -->
- Source code
- Completed `20250801T153742+0000` prompt
- Automated tests checked against manual tests
</gsl-outputs>

<gsl-workflows>

## 4. Workflows

#### **Minimal PyPI Release Workflow**

1. **Bump version**  
    Edit `pyproject.toml` → update `version = "..."`
    
2. **Clean & build**
    
    ```powershell
    Remove-Item -Recurse -Force dist, build, *.egg-info
    hatch build

    ```
    
3. **Upload**
    
    ```powershell
    twine upload dist/*
    ```
    

* * *

#### **What to check**

* `pip install obk` works **from PyPI** (not just from your local dist).
    
* The installed CLI works:
    
    * `obk hello-world`
        
    * `obk validate-all --prompts-dir ...`  
        (Check that schema files are available and validation works!)
        
* CLI shows correct help output.
    
* No `ModuleNotFoundError` or “can’t find resource” errors.
    
* All included package data (`xsd/*.xsd`, etc.) are present and loaded.
    
* Tests and real-world usage work as expected.

#### **Pro Tip**

If you’re doing this from a **clean machine or VM** (or just a new venv), you’ll catch “it works on my machine” bugs before your users do!

You can also run:

```bash
pip uninstall obk
pip install obk
```

on your own machine, but a _truly_ fresh environment is even better.
</gsl-workflows>

<gsl-tdd>

<gsl-description>

## 5. Tests

<!--
Add single-line manual tests here.
Each `<gsl-test>` element should fully validate a required feature or edge case.
You may add a code block (with triple backticks) under each test if needed.
-->

</gsl-description>

<gsl-test id="T1">

- Run `pip install obk` from a fresh machine. 
</gsl-test>

<gsl-test id="T2">

- T2: `obk validate-all --prompts-dir valid_prompts/` -> All prompt files are valid
</gsl-test>

<gsl-test id="T3">

- T3: `obk validate-all --prompts-dir invalid_prompts/` -> reports validation error
</gsl-test>

<gsl-test id="T4">

- T4: file name containing "surgery" uses mapped schema during validation
</gsl-test>

<gsl-test id="T5">

- T5: schemas load via `importlib.resources` when installed as a package
</gsl-test>

</gsl-tdd>

<gsl-document-spec>

## 6. Document Specification

#### Overview

This section defines the rules and conventions for maintaining and updating this prompt document.
This specification applies only to this prompt document.

#### S-1. Identifier and Numbering

Major sections and tests in this document must use a clear, hierarchical ID. Use an uppercase prefix and numbers, like `T1`, `T2.1`, or `S1.2.3`:

* Use `T` for tests in `<gsl-tdd>` (e.g., `T1`, `T2.1`).
* Use `S` for specification items if needed (e.g., `S1`, `S2.1`).
* Number all items in order, with no gaps or repeats.
* Do not remove or change IDs except to fix errors.

These IDs are required for referencing, tracking, and audits.

#### S-2. Update Policy

These rules apply to automated changes by agents. Manual edits by maintainers can update any section.

* Agents **may only** update these sections:

  * `<gsl-workflows>` (agents may add, change, or remove any part)
  * `<gsl-tdd>` (agents may add new `<gsl-test>` elements, but may not change or remove any existing `<gsl-test>`)
* Agents **must not** change or remove any other content in this document.

These rules protect the integrity of the document and its tests, while allowing agents to add workflows and new tests.

#### S-3. Tests Section

* `<gsl-tdd>` holds one or more `<gsl-test>` elements.
* Each `<gsl-test>` must start with a single-line description and have a unique `id` (e.g., `T1`, `T2`, etc).
* You may add a code block (with triple backticks) below the test description if needed.
* Agents may only add new `<gsl-test>` elements. They must not change or remove any existing test.
* Only maintainers can change or remove tests.
* Use these tests for auditing and validation.

</gsl-document-spec>
</gsl-block>
</gsl-prompt>
