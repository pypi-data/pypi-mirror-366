<!--
Standardized GSL prompt and spec for OBK/Codex agent work.
- Fill in all sections as needed.
- Rules for agent/maintainer updates are in the Document Specification section.
- Agents may only update workflows and add new tests (see rules).
- Everything else is for maintainers.
-->

<?xml version="1.0" encoding="UTF-8"?>
<gsl-prompt id="20250730T160316-0400">

<gsl-header>

# Integrate Typer CLI Framework 
</gsl-header>

<!--
Note: This GSL document uses XML-like section tags as containers, but the content inside each section may include markdown, tables, or other non-XML elements. Strict XML parsing is neither required nor expected; all parsing and automation should be tolerant of mixed content.
-->

<gsl-block>

<gsl-purpose>

## 1. Purpose

Integrate the Typer framework into the `obk` CLI, following best practices for modularity and testability. 

</gsl-purpose>

<gsl-inputs>

## 2. Inputs

| Input | Notes |
| --- | --- |
| Typer CLI Framework—When to Use It, and When to Pass | Article on Typer’s pros, cons, and recommended usage patterns |
| Why One-Line Manual Tests Should Precede Automation | Article on manual-first, interface-driven test writing |
| OBK/Codex Standard Prompt Template | Template for tasks, specs, and workflows |

</gsl-inputs>

<gsl-outputs>

## 3. Outputs

* **Converted the CLI to use Typer**
    
    * Explicit command names and help messages.
        
    * Added a new `greet` command with an `--excited` flag.
        
    * Execution errors now result in clean exits.
        
* **Testing**
    
    * Added a test to verify the new `greet --excited` behavior.
        
    * Documented manual CLI tests in the prompt specification for traceability.
        
    * **Testing:**  
        * ✅ `pytest -q`



</gsl-outputs>

<gsl-workflows>

## 4. Workflows

#### How to Add a New Command (Typer CLI)

##### 1. Implement the Command Logic

Add a private method for your command in `src/obk/cli.py`:

```python
def _cmd_greet(self, name: str, excited: bool = False) -> None:
    if excited:
        typer.echo(f"Hello, {name}!!!")
    else:
        typer.echo(f"Hello, {name}.")
```



##### 2. Register the Command

Register your method as a Typer command in `src/obk/cli.py`:

```python
self.app.command(
    name="greet",
    help="Greet by name with optional excitement",
    short_help="Greet by name",
)(self._cmd_greet)
```



##### 3. (Optional) Add Services

For reusable logic or dependencies:

* Create a class in `src/obk/services.py`.
* Expose it via the DI container (`src/obk/containers.py`).



##### 4. Write CLI Tests

In `tests/test_cli.py`, add a subprocess-style test to verify the command:

```python
result = subprocess.run(
    [sys.executable, "-m", "obk", "greet", "Ada", "--excited"],
    capture_output=True,
    text=True,
    check=True,
    cwd=tmp_path,
    env=env,
)
assert result.stdout.strip() == "Hello, Ada!!!"
```

##### 5. Lint, Format, and Run Tests

Before submitting, **run all quality checks**:

```sh
ruff .
black .
pytest
```

##### 6. Document (Optional)

Update the README to mention the new command so users know it exists.



#### **Why This Works**

* **Modular & Testable:** Each command is a self-contained method.
* **Extensible:** Typer makes it easy to add, organize, and test new commands.
* **Scalable:** Adding new features and dependency-injected services is straightforward.



**Summary Workflow**

1. Define logic in `src/obk/cli.py`
2. Register via `self.app.command(...)`
3. Add services if needed
4. Write subprocess tests
5. Lint, format, and test
6. Update documentation


This pattern keeps your CLI maintainable and easy to extend.


</gsl-workflows>


<!--
Add single-line manual tests here.
Each <gsl-test> element should fully validate a required feature or edge case.
You may add a code block (with triple backticks) under each test if needed.
-->

<gsl-tdd>

## 5. Tests

<gsl-test id="T1">

- **PASSED** T1: CLI greets user by name 

    ```powershell
    obk greet --name Ada
    Hello, Ada.
    ```

</gsl-test>


<gsl-test id="T2">

- **PASSED** T2: Help screen displays all arguments and options

    ```powershell
    obk --help
    # (Should display 'greet', 'name', 'excited', etc.)
    ```

</gsl-test>

<gsl-test id="T7"> 

- **PASSED** T7: `obk greet Ada --excited` -> Hello, Ada!!!</gsl-test>
<gsl-test id="T8"> 

- **PASSED** T8: `obk divide 4 2` -> 2.0</gsl-test>
<gsl-test id="T9"> 

- **PASSED** T9: `obk divide 1 0` -> exit 2</gsl-test>
<gsl-test id="T10"> 

- **PASSED** T10: `obk hello-world -h` -> shows 'Print hello world'</gsl-test>
<gsl-test id="T11">

- T11: `obk hello-world` -> hello world

</gsl-test>
<gsl-test id="T12">

- T12: `obk fail` -> exit 1 and prints fatal message

</gsl-test>
<gsl-test id="T13">

- T13: Greeter service can be overridden for `greet`

</gsl-test>
<gsl-test id="T14">

- T14: Divider service can be overridden for `divide`

</gsl-test>
<gsl-test id="T15">

- T15: `obk --logfile custom.log divide 4 2` creates `custom.log`

</gsl-test>
</gsl-tdd>

<gsl-document-spec>

## 6. Document Specification

#### Overview

This section defines the rules and conventions for maintaining and updating this prompt document.
This specification applies only to this prompt document.

#### S-1. Identifier and Numbering

Major sections and tests in this document must use a clear, hierarchical ID. Use an uppercase prefix and numbers, like `T1`, `T2.1`, or `S1.2.3`:

* Use `T` for tests in `<gsl-tdd>` (e.g., `T1`, `T2.1`).
* Use `S` for specification items if needed (e.g., `S1`, `S2.1`).
* Number all items in order, with no gaps or repeats.
* Do not remove or change IDs except to fix errors.

These IDs are required for referencing, tracking, and audits.

#### S-2. Update Policy

These rules apply to automated changes by agents. Manual edits by maintainers can update any section.

* Agents **may only** update these sections:

  * `<gsl-workflows>` (agents may add, change, or remove any part)
  * `<gsl-tdd>` (agents may add new `<gsl-test>` elements, but may not change or remove any existing `<gsl-test>`)
* Agents **must not** change or remove any other content in this document.

These rules protect the integrity of the document and its tests, while allowing agents to add workflows and new tests.

#### S-3. Tests Section

* `<gsl-tdd>` holds one or more `<gsl-test>` elements.
* Each `<gsl-test>` must start with a single-line description and have a unique `id` (e.g., `T1`, `T2`, etc).
* You may add a code block (with triple backticks) below the test description if needed.
* Agents may only add new `<gsl-test>` elements. They must not change or remove any existing test.
* Only maintainers can change or remove tests.
* Use these tests for auditing and validation.

</gsl-document-spec>
</gsl-block>
