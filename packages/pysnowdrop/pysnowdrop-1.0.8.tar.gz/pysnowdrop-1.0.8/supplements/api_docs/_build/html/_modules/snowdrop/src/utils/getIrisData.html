<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>snowdrop.src.utils.getIrisData &#8212; Python Platform 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for snowdrop.src.utils.getIrisData</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">re</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.misc.termcolor</span> <span class="kn">import</span> <span class="n">cprint</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.utils.util</span> <span class="kn">import</span> <span class="n">read_and_combine_text</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>


<div class="viewcode-block" id="handleMovingAverageOperator">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.getIrisData.handleMovingAverageOperator">[docs]</a>
<span class="k">def</span> <span class="nf">handleMovingAverageOperator</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles IRIS moving average operator.&quot;&quot;&quot;</span>
    <span class="n">new_expr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_expr</span> <span class="o">+=</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="n">expr</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_expr</span> <span class="o">+=</span> <span class="s2">&quot;+(&quot;</span> <span class="o">+</span> <span class="n">expr</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sign</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;))&quot;</span>
        
    <span class="n">new_expr</span> <span class="o">=</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="n">new_expr</span> <span class="o">+</span> <span class="s2">&quot;) / &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">new_expr</span></div>

 
<div class="viewcode-block" id="handleMovingSumOperator">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.getIrisData.handleMovingSumOperator">[docs]</a>
<span class="k">def</span> <span class="nf">handleMovingSumOperator</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles IRIS moving sum operator.&quot;&quot;&quot;</span>
    <span class="n">new_expr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_expr</span> <span class="o">+=</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="n">expr</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_expr</span> <span class="o">+=</span> <span class="s2">&quot;+(&quot;</span> <span class="o">+</span> <span class="n">expr</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sign</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;))&quot;</span>
        
    <span class="n">new_expr</span> <span class="o">=</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="n">new_expr</span> <span class="o">+</span> <span class="s2">&quot;) &quot;</span>
    <span class="k">return</span> <span class="n">new_expr</span>            </div>

     
<div class="viewcode-block" id="handleDiffOperator">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.getIrisData.handleDiffOperator">[docs]</a>
<span class="k">def</span> <span class="nf">handleDiffOperator</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles IRIS difference operator.&quot;&quot;&quot;</span>
    <span class="n">new_expr</span> <span class="o">=</span> <span class="s2">&quot; ((&quot;</span> <span class="o">+</span> <span class="n">expr</span> <span class="o">+</span> <span class="s2">&quot;) - (&quot;</span> <span class="o">+</span> <span class="n">expr</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;))) &quot;</span>
    <span class="k">return</span> <span class="n">new_expr</span>            </div>

                            
<div class="viewcode-block" id="handleDiffLogOperator">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.getIrisData.handleDiffLogOperator">[docs]</a>
<span class="k">def</span> <span class="nf">handleDiffLogOperator</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles IRIS difference of log operator.&quot;&quot;&quot;</span>
    <span class="n">new_expr</span> <span class="o">=</span> <span class="s2">&quot; (log(&quot;</span> <span class="o">+</span> <span class="n">expr</span> <span class="o">+</span> <span class="s2">&quot;) - log(&quot;</span> <span class="o">+</span> <span class="n">expr</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;))) &quot;</span>
    <span class="k">return</span> <span class="n">new_expr</span>            </div>

                     
<div class="viewcode-block" id="emulateModelLanguageOperators">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.getIrisData.emulateModelLanguageOperators">[docs]</a>
<span class="k">def</span> <span class="nf">emulateModelLanguageOperators</span><span class="p">(</span><span class="n">equation</span><span class="p">,</span><span class="n">operator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Emulate IRIS modelling language special operators like movavg(expr,n) for n-period moving average</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">equation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">operator</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Nothing to do</span>
        <span class="k">return</span> <span class="n">equation</span>  
    
    <span class="n">new_eq</span> <span class="o">=</span> <span class="n">equation</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
    <span class="n">rest_eq</span> <span class="o">=</span> <span class="n">equation</span>
    <span class="k">while</span> <span class="n">ind</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">rest_eq</span> <span class="o">=</span> <span class="n">rest_eq</span><span class="p">[</span><span class="n">ind</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">operator</span><span class="p">):]</span>
        <span class="n">arr1</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">arr2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(&quot;</span><span class="p">,</span> <span class="n">rest_eq</span><span class="p">):</span>
            <span class="n">arr1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\)&quot;</span><span class="p">,</span> <span class="n">rest_eq</span><span class="p">):</span>
            <span class="n">arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">())</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">arr1</span> <span class="o">+</span> <span class="n">arr2</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">arr1</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">arr2</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">rest_eq</span><span class="p">[:</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operator</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;movavg&quot;</span><span class="p">,</span><span class="s2">&quot;movsum&quot;</span><span class="p">]:</span>
            <span class="c1"># Find difference n-period</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ex</span> <span class="o">=</span> <span class="n">expr</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+$&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">):</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
                    <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;movavg&quot;</span><span class="p">:</span>
                <span class="n">new_expr</span> <span class="o">=</span> <span class="n">handleMovingAverageOperator</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">expr</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;movsum&quot;</span><span class="p">:</span>
                <span class="n">new_expr</span> <span class="o">=</span> <span class="n">handleMovingSumOperator</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;difflog&quot;</span><span class="p">:</span>
            <span class="c1"># Find difference n-period</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ex</span> <span class="o">=</span> <span class="n">expr</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+$&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">):</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
                    <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;diff&quot;</span><span class="p">:</span>
                <span class="n">new_expr</span> <span class="o">=</span> <span class="n">handleDiffOperator</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">expr</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;difflog&quot;</span><span class="p">:</span>
                <span class="n">new_expr</span> <span class="o">=</span> <span class="n">handleDiffLogOperator</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">expr</span><span class="p">)</span>
        <span class="n">new_eq</span> <span class="o">+=</span>  <span class="n">new_expr</span>    
        <span class="n">rest_eq</span> <span class="o">=</span> <span class="n">rest_eq</span><span class="p">[</span><span class="n">l</span><span class="p">:]</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">rest_eq</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">operator</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">new_eq</span>	</div>



<div class="viewcode-block" id="readIrisModelFile">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.getIrisData.readIrisModelFile">[docs]</a>
<span class="k">def</span> <span class="nf">readIrisModelFile</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="n">conditions</span><span class="o">=</span><span class="p">{},</span><span class="n">bFillValues</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">strVariables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;!variables&quot;</span><span class="p">,</span><span class="s2">&quot;!transition_variables&quot;</span><span class="p">],</span><span class="n">strShocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;!shocks&quot;</span><span class="p">,</span><span class="s2">&quot;!transition_shocks&quot;</span><span class="p">],</span>
                      <span class="n">strParameters</span> <span class="o">=</span> <span class="s2">&quot;!parameters&quot;</span><span class="p">,</span><span class="n">strEquations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;!equations&quot;</span><span class="p">,</span><span class="s2">&quot;!transition_equations&quot;</span><span class="p">],</span>
                      <span class="n">strMeasurementVariables</span><span class="o">=</span><span class="s2">&quot;!measurement_variables&quot;</span><span class="p">,</span><span class="n">strMeasurementEquations</span><span class="o">=</span><span class="s2">&quot;!measurement_equations&quot;</span><span class="p">,</span>
                      <span class="n">strMeasuarementShocks</span><span class="o">=</span><span class="s2">&quot;!measurement_shocks&quot;</span><span class="p">,</span><span class="n">strLegend</span><span class="o">=</span><span class="s2">&quot;legend&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read IRIS model file.&quot;&quot;&quot;</span>
    
    <span class="n">delimiters</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span>
    <span class="n">regexPattern</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">,</span> <span class="n">delimiters</span><span class="p">))</span>
        
    <span class="n">txt</span><span class="o">=</span><span class="p">[];</span><span class="n">txtEqs</span><span class="o">=</span><span class="p">[];</span><span class="n">txtParams</span><span class="o">=</span><span class="p">[];</span><span class="n">txtParamsRange</span><span class="o">=</span><span class="p">[];</span><span class="n">txtEndogVars</span><span class="o">=</span><span class="p">[];</span>
    <span class="n">txtShocks</span><span class="o">=</span><span class="p">[];</span><span class="n">txtMeasVar</span><span class="o">=</span><span class="p">[];</span><span class="n">txtMeasEqs</span><span class="o">=</span><span class="p">[];</span><span class="n">txtMeasShocks</span><span class="o">=</span><span class="p">[];</span><span class="n">txtLegend</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">txtRange</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span><span class="n">txtFreq</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span><span class="n">txtDescription</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span>  <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span><span class="s2">&quot;**&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">read_and_combine_text</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="n">conditions</span><span class="o">=</span><span class="n">conditions</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
    <span class="c1"># Parse model file</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">ln</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ln</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ln</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;//&quot;</span><span class="p">)</span>  <span class="ow">or</span> <span class="n">ln</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">ln2</span> <span class="o">=</span> <span class="n">ln</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
        <span class="c1">#print (&quot;-&quot; + ln2 + &quot;-&quot;)</span>
        <span class="k">if</span> <span class="n">ln</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ln</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;legend&quot;</span><span class="p">):</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">ln</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">ln2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strEquations</span><span class="p">:</span>
                <span class="n">txtEqs</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strVariables</span><span class="p">:</span>
                <span class="n">txtEndogVars</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strParameters</span><span class="p">:</span>
                <span class="n">txtParams</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strShocks</span><span class="p">:</span>
                <span class="n">txtShocks</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;var &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strMeasurementVariables</span><span class="p">:</span>
                <span class="n">txtMeasVar</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strMeasurementEquations</span><span class="p">:</span>
                <span class="n">txtMeasEqs</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strMeasuarementShocks</span><span class="p">:</span>
                <span class="n">txtMeasShocks</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">header</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">strLegend</span><span class="p">:</span>
                <span class="n">txtLegend</span><span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">bool</span><span class="p">(</span><span class="n">ln2</span><span class="p">):</span>
            <span class="n">txt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ln2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;EXP(&#39;</span><span class="p">,</span><span class="s1">&#39;exp(&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;LOG(&#39;</span><span class="p">,</span><span class="s1">&#39;log(&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;SIN(&#39;</span><span class="p">,</span><span class="s1">&#39;sin(&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;COS(&#39;</span><span class="p">,</span><span class="s1">&#39;cos(&#39;</span><span class="p">))</span>

    <span class="c1"># Process the last line</span>
    <span class="k">if</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strEquations</span><span class="p">:</span>
        <span class="n">txtEqs</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strMeasurementEquations</span><span class="p">:</span>
        <span class="n">txtMeasEqs</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strVariables</span><span class="p">:</span>
        <span class="n">txtEndogVars</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strMeasurementVariables</span><span class="p">:</span>
        <span class="n">txtMeasVar</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strParameters</span><span class="p">:</span>
        <span class="n">txtParams</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strShocks</span><span class="p">:</span>
        <span class="n">txtShocks</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;var &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strMeasuarementShocks</span><span class="p">:</span>
        <span class="n">txtMeasShocks</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;var &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">strLegend</span><span class="p">:</span>
        <span class="n">txtLegend</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        
    <span class="n">txtEqs</span> <span class="o">=</span> <span class="n">txtEqs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">,</span><span class="s2">&quot;(&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">,</span><span class="s2">&quot;)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;=#&quot;</span><span class="p">,</span><span class="s2">&quot;=&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">eqs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">txtEqs</span> <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="n">txtMeasEqs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">txtMeasEqs</span> <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    
    <span class="n">var</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txtEndogVars</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[);\W]+&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">lbl</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
        
    <span class="n">txtEndogVars</span> <span class="o">=</span> <span class="n">var</span>
   
    <span class="n">txtEqs</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">ss</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">eqtn</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">operators</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;movavg&quot;</span><span class="p">,</span><span class="s2">&quot;movsum&quot;</span><span class="p">,</span><span class="s2">&quot;diff&quot;</span><span class="p">,</span><span class="s2">&quot;difflog&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">eq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eqs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">eq</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">eqtn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">txtEqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eqtn</span><span class="p">)</span>
            <span class="n">eqtn</span> <span class="o">=</span> <span class="n">eq</span>
            <span class="c1"># ind = eq.index(&#39;=&#39;)</span>
            <span class="c1"># arr = re.split(regexPattern,eq[:ind])</span>
            <span class="c1"># arr = list(filter(None,arr))</span>
            <span class="c1"># if bool(arr):</span>
            <span class="c1">#     if len(arr) == 1:</span>
            <span class="c1">#         labels.append(arr[0])</span>
            <span class="c1">#     else:</span>
            <span class="c1">#         labels.append(str(i))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">eqtn</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">eq</span>
        <span class="k">if</span> <span class="s2">&quot;!!&quot;</span> <span class="ow">in</span> <span class="n">eqtn</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">eqtn</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;!!&quot;</span><span class="p">)</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">eqtn</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:]</span>
            <span class="n">eqtn</span> <span class="o">=</span> <span class="n">eqtn</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
                <span class="n">ind2</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">ind2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">ss</span><span class="p">[</span><span class="n">eqtn</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
        <span class="c1"># Handle IRIS operators</span>
        <span class="k">for</span> <span class="n">operator</span> <span class="ow">in</span> <span class="n">operators</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">operator</span> <span class="ow">in</span> <span class="n">eqtn</span><span class="p">:</span>
                <span class="n">eqtn</span> <span class="o">=</span> <span class="n">emulateModelLanguageOperators</span><span class="p">(</span><span class="n">equation</span><span class="o">=</span><span class="n">eqtn</span><span class="p">,</span><span class="n">operator</span><span class="o">=</span><span class="n">operator</span><span class="p">)</span>
            
    <span class="c1"># Append the last one        </span>
    <span class="n">txtEqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eqtn</span><span class="p">)</span>
    
    <span class="n">meas_var</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">meas_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txtMeasVar</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
            <span class="n">meas_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="n">ind</span><span class="p">])</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">meas_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">meas_var</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meas_var</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">txtMeasVar</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">meas_var</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
    
    <span class="n">meas_eqs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txtMeasEqs</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">meas_eqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">meas_eqs</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meas_eqs</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">txtMeasEqs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">meas_eqs</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
        
    <span class="n">meas_shocks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txtMeasShocks</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">meas_shocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">meas_shocks</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meas_shocks</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">txtMeasShocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">meas_shocks</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
        
    <span class="n">shock_var</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">shock_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txtShocks</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
            <span class="n">shock_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="n">ind</span><span class="p">])</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:]</span>
        <span class="n">shock_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">shock_var</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shock_var</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">txtShocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">shock_var</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
    
    <span class="n">param_var</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">param_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txtParams</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
            <span class="n">param_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="n">ind</span><span class="p">])</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:]</span>
        <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">param_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">param_var</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">param_var</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">txtParams</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">param_var</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
    
    
    <span class="k">if</span> <span class="n">bFillValues</span><span class="p">:</span>
        
        <span class="n">delimiters</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span>
        <span class="n">regexPattern</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">,</span> <span class="n">delimiters</span><span class="p">))</span>
            
        <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">txtParams</span><span class="p">:</span>
            <span class="n">arr2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">regexPattern</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arr2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; = 1&quot;</span><span class="p">)</span>
        <span class="n">txtParams</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>   
                
        <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">txtEndogVars</span><span class="p">:</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; = 1&quot;</span><span class="p">)</span>
        <span class="n">txtEndogVars</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
            
        <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">txtShocks</span><span class="p">:</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; = 0&quot;</span><span class="p">)</span>
        <span class="n">txtShocks</span> <span class="o">=</span> <span class="n">arr</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;Date&quot;</span> <span class="ow">in</span> <span class="n">txtShocks</span><span class="p">:</span>
            <span class="n">txtShocks</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;Date : 01/01/2020&quot;</span><span class="p">)</span> 
            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">txtRange</span><span class="p">:</span>
            <span class="n">txtRange</span> <span class="o">=</span> <span class="s2">&quot;01/01/2020 - 01/01/2100&quot;</span>
        
        <span class="n">txtEqs</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txtEqs</span><span class="p">)</span>
        <span class="n">txtShocks</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">txtShocks</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">txtEqs</span><span class="p">,</span><span class="n">txtParams</span><span class="p">,</span><span class="n">txtParamsRange</span><span class="p">,</span><span class="n">txtEndogVars</span><span class="p">,</span><span class="n">txtMeasVar</span><span class="p">,</span><span class="n">txtShocks</span><span class="p">,</span><span class="n">txtRange</span><span class="p">,</span><span class="n">txtFreq</span><span class="p">,</span><span class="n">txtDescription</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">txtEqs</span><span class="p">,</span><span class="n">txtMeasEqs</span><span class="p">,</span><span class="n">txtParams</span><span class="p">,</span><span class="n">txtEndogVars</span><span class="p">,</span><span class="n">txtMeasVar</span><span class="p">,</span><span class="n">txtMeasEqs</span><span class="p">,</span><span class="n">txtShocks</span><span class="p">,</span><span class="n">txtMeasShocks</span><span class="p">,</span><span class="n">ss</span><span class="p">,</span><span class="n">labels</span></div>



<div class="viewcode-block" id="getIrisModel">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.getIrisData.getIrisModel">[docs]</a>
<span class="k">def</span> <span class="nf">getIrisModel</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">calibration</span><span class="o">=</span><span class="p">{},</span><span class="n">options</span><span class="o">=</span><span class="p">{},</span><span class="n">conditions</span><span class="o">=</span><span class="p">{},</span><span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">tag_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;!variables&quot;</span><span class="p">,</span><span class="s2">&quot;!transition_variables&quot;</span><span class="p">],</span><span class="n">tag_shocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;!shocks&quot;</span><span class="p">,</span><span class="s2">&quot;!transition_shocks&quot;</span><span class="p">],</span>
                     <span class="n">tag_parameters</span> <span class="o">=</span> <span class="s2">&quot;!parameters&quot;</span><span class="p">,</span><span class="n">tag_equations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;!equations&quot;</span><span class="p">,</span><span class="s2">&quot;!transition_equations&quot;</span><span class="p">],</span>
                     <span class="n">tag_measurement_variables</span><span class="o">=</span><span class="s2">&quot;!measurement_variables&quot;</span><span class="p">,</span>
                     <span class="n">tag_measurement_equations</span><span class="o">=</span><span class="s2">&quot;!measurement_equations&quot;</span><span class="p">,</span>
                     <span class="n">tag_measurement_shocks</span><span class="o">=</span><span class="s2">&quot;!measurement_shocks&quot;</span><span class="p">,</span>
                     <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads Iris model file and instantiates this model.</span>

<span class="sd">    Args:</span>
<span class="sd">        fpath : str.</span>
<span class="sd">            Path to Iris model file.</span>
<span class="sd">        calibration : dict.</span>
<span class="sd">            Map with values of calibrated parameters and starting values of endogenous variables.</span>
<span class="sd">        options : dict, optional</span>
<span class="sd">            Dictionary of options. The default is empty dictionary.</span>
<span class="sd">        conditions : dict, optional</span>
<span class="sd">            Choose block of code based on logical condition. The default is empty list.</span>
<span class="sd">        use_cache : bool, optional</span>
<span class="sd">            If True reads previously saved model from a file of model dump.</span>
<span class="sd">        tag_variables : list, optional</span>
<span class="sd">            Tag for endogenous variables section. The default is &quot;!transition_variables&quot;.</span>
<span class="sd">        tag_shocks : str, optional</span>
<span class="sd">            Tag for shock variables section. The default is &quot;!transition_shocks&quot;.</span>
<span class="sd">        tag_parameters : str, optional</span>
<span class="sd">            Tag for parameters section. The default is &quot;!parameters&quot;.</span>
<span class="sd">        tag_equations : TYPE, optional</span>
<span class="sd">            Tag for equations section. The default is &quot;!transition_equations&quot;.</span>
<span class="sd">        tag_measurement_variables : str, optional</span>
<span class="sd">            Tag for measurement variables section. The default is &quot;!measurement_variables&quot;.</span>
<span class="sd">        tag_measurement_equations : str, optional</span>
<span class="sd">            Tag for measurement equations section. The default is &quot;!measurement_equations&quot;.</span>
<span class="sd">        debug : bool, optional</span>
<span class="sd">            If set to True prints information on Iris model file sections. The default is False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Model object.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.model.factory</span> <span class="kn">import</span> <span class="n">getModel</span>
    
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">fpath</span><span class="p">))</span>
    <span class="n">fname</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">fname</span><span class="o">+</span><span class="n">ext</span><span class="p">,</span><span class="n">fname</span><span class="o">+</span><span class="s2">&quot;.bin&quot;</span><span class="p">)</span>
    <span class="n">model_file_exist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">use_cache</span> <span class="ow">and</span> <span class="n">model_file_exist</span><span class="p">:</span>
        
        <span class="kn">from</span> <span class="nn">snowdrop.src.utils.interface</span> <span class="kn">import</span> <span class="n">loadModel</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.preprocessor.util</span> <span class="kn">import</span> <span class="n">updateFiles</span>
        
        <span class="n">model</span> <span class="o">=</span> <span class="n">loadModel</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>        
        <span class="n">updateFiles</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;/../preprocessor&quot;</span><span class="p">)</span>
                
        
        <span class="c1"># Update model variables and parameters values</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
        <span class="n">mv</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span> 
        <span class="n">mp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">calibration</span><span class="p">:</span>
                <span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calibration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;_plus_&quot;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;_plus_&quot;</span><span class="p">)</span>
                <span class="n">kk</span>  <span class="o">=</span> <span class="n">k</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">calibration</span><span class="p">:</span>
                    <span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calibration</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;_minus_&quot;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;_minus_&quot;</span><span class="p">)</span>
                <span class="n">kk</span>  <span class="o">=</span> <span class="n">k</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">calibration</span><span class="p">:</span>
                    <span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calibration</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span>
                    
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">calibration</span><span class="p">:</span>
                <span class="n">mp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calibration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        
        <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mv</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mp</span>
        <span class="n">model</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">calibration_dict</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">model</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">calibration_dict</span><span class="p">,</span><span class="o">**</span><span class="n">calibration</span><span class="p">}</span>
        
    <span class="k">else</span><span class="p">:</span>
        
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">infos</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span><span class="s1">&#39;filename&#39;</span> <span class="p">:</span> <span class="n">file_path</span><span class="p">}</span>   
        
        <span class="n">eqs</span><span class="p">,</span><span class="n">measEqs</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">variables</span><span class="p">,</span><span class="n">measVar</span><span class="p">,</span><span class="n">measEqs</span><span class="p">,</span><span class="n">shocks</span><span class="p">,</span><span class="n">measShocks</span><span class="p">,</span><span class="n">ss</span><span class="p">,</span><span class="n">labels</span> <span class="o">=</span> \
            <span class="n">readIrisModelFile</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span><span class="n">conditions</span><span class="o">=</span><span class="n">conditions</span><span class="p">,</span><span class="n">bFillValues</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">strVariables</span><span class="o">=</span><span class="n">tag_variables</span><span class="p">,</span><span class="n">strShocks</span><span class="o">=</span><span class="n">tag_shocks</span><span class="p">,</span><span class="n">strParameters</span><span class="o">=</span><span class="n">tag_parameters</span><span class="p">,</span><span class="n">strEquations</span><span class="o">=</span><span class="n">tag_equations</span><span class="p">,</span>
                              <span class="n">strMeasurementVariables</span><span class="o">=</span><span class="n">tag_measurement_variables</span><span class="p">,</span><span class="n">strMeasurementEquations</span><span class="o">=</span><span class="n">tag_measurement_equations</span><span class="p">,</span>
                              <span class="n">strMeasuarementShocks</span><span class="o">=</span><span class="n">tag_measurement_shocks</span><span class="p">)</span>  
            
        <span class="n">var_labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span><span class="n">labels</span><span class="p">))</span>
        <span class="n">eqs_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">eqs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">eq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eqs</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">eq</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                <span class="n">lbl</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">eqs_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lbl</span>
                
        <span class="n">labels</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>  
            <span class="n">equations</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">eqs</span><span class="p">)</span>
            <span class="n">meas_equations</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">measEqs</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parameters:</span><span class="se">\n</span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Transition Shocks:</span><span class="se">\n</span><span class="si">{</span><span class="n">shocks</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Transition Variables:</span><span class="se">\n</span><span class="si">{</span><span class="n">variables</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Transition Equations:</span><span class="se">\n</span><span class="si">{</span><span class="n">equations</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Labels of Variables:</span><span class="se">\n</span><span class="si">{</span><span class="n">var_labels</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Measurement Variables:</span><span class="se">\n</span><span class="si">{</span><span class="n">measVar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Measurement Equations:</span><span class="se">\n</span><span class="si">{</span><span class="n">meas_equations</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Measurement Shocks:</span><span class="se">\n</span><span class="si">{</span><span class="n">measShocks</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Model file defines the following steady states of variables: </span><span class="se">\n</span><span class="si">{</span><span class="n">ss</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
            
        <span class="n">model</span> <span class="o">=</span> <span class="n">getModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">eqs</span><span class="o">=</span><span class="n">eqs</span><span class="p">,</span><span class="n">ss</span><span class="o">=</span><span class="n">ss</span><span class="p">,</span><span class="n">meas_eqs</span><span class="o">=</span><span class="n">measEqs</span><span class="p">,</span><span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">,</span><span class="n">shocks</span><span class="o">=</span><span class="n">shocks</span><span class="p">,</span>
                         <span class="n">meas_variables</span><span class="o">=</span><span class="n">measVar</span><span class="p">,</span><span class="n">calibration</span><span class="o">=</span><span class="n">calibration</span><span class="p">,</span><span class="n">var_labels</span><span class="o">=</span><span class="n">var_labels</span><span class="p">,</span><span class="n">meas_shocks</span><span class="o">=</span><span class="n">measShocks</span><span class="p">,</span>
                         <span class="n">eqs_labels</span><span class="o">=</span><span class="n">eqs_labels</span><span class="p">,</span><span class="n">check</span><span class="o">=</span><span class="n">check</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span><span class="n">infos</span><span class="o">=</span><span class="n">infos</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
        
        <span class="c1"># Serialize model into file</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.utils.interface</span> <span class="kn">import</span> <span class="n">saveModel</span>
        <span class="n">saveModel</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span><span class="n">model</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">model</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The main program.&quot;&quot;&quot;</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../../../supplements/models/TOY/RBC.model&#39;</span><span class="p">))</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">getIrisModel</span><span class="p">(</span><span class="n">fpath</span><span class="o">=</span><span class="n">fpath</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
   
 
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">Python Platform</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/modules.html">snowdrop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../info.html">Python Platform</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Alexei Goumilevski.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>