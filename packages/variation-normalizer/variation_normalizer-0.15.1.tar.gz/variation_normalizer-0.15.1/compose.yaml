services:
  api:
    image: cancervariants/variation-normalizer-api:latest
    environment:
      SEQREPO_ROOT_DIR: /usr/local/share/seqrepo/2024-12-20
      AWS_ACCESS_KEY_ID: 'DUMMYIDEXAMPLE'
      AWS_SECRET_ACCESS_KEY: 'DUMMYEXAMPLEKEY'
      AWS_DEFAULT_REGION: 'us-east-2'
      GENE_NORM_DB_URL: http://gene-dynamodb-local:8000
      UTA_DB_URL: postgresql://anonymous@uta:5432/uta/uta_20241220

    ports:
      - "8001:80"

    depends_on:
      uta:
        condition: service_started
      gene-dynamodb-local:
        condition: service_started

    volumes:
      - uta_vol:/var/lib/postgresql/data
      - /usr/local/share/seqrepo:/usr/local/share/seqrepo

  uta:
    # Test:
    # psql -XAt postgres://anonymous@localhost/uta -c 'select count(*) from uta_20241220.transcript'
    # 329090
    image: biocommons/uta:uta_20241220
    environment:
      - POSTGRES_PASSWORD=some-password-that-you-make-up
    volumes:
      - uta_vol:/var/lib/postgresql/data
      - ./uta-setup.sql:/docker-entrypoint-initdb.d/uta-setup.sql
    ports:
      - 5432:5432

  gene-dynamodb-local:
    image: cancervariants/gene-normalizer-ddb:latest
    ports:
     - "8000:8000"

volumes:
  uta_vol:
    external: true
