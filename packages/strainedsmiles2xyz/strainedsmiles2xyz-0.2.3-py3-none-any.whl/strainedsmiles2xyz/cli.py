import sys
import multiprocessing
from . import smiles_to_xyz
import math

def mol_to_xyz(mol):
    conf = mol.GetConformer()
    atoms = mol.GetAtoms()
    lines = [str(mol.GetNumAtoms()), "generated by strainedSMILES2xyz"]
    for atom in atoms:
        pos = conf.GetAtomPosition(atom.GetIdx())
        lines.append(f"{atom.GetSymbol()} {pos.x:.6f} {pos.y:.6f} {pos.z:.6f}")
    return "\n".join(lines)


def main():
    if len(sys.argv) < 2:
        print("Usage: python -m strainedsmiles2xyz <SMILES>", file=sys.stderr)
        sys.exit(1)
    smiles = sys.argv[1]
    cores = math.ceil(multiprocessing.cpu_count() / 2)
    mol = smiles_to_xyz(smiles, print_level=0, use_orca_corrections=True, n_cores=cores)[0]
    print(mol_to_xyz(mol))