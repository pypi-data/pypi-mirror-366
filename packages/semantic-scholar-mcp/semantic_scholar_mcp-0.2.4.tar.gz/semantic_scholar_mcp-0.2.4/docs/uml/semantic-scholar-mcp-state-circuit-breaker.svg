<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="STATE" height="960px" preserveAspectRatio="none" style="width:931px;height:960px;background:#FFFFFF;" version="1.1" viewBox="0 0 931 960" width="931px" zoomAndPan="magnify"><title>Circuit Breaker State Machine</title><defs/><g><g class="title" data-source-line="3"><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="372.2705" x="274.9602" y="35.4209">Circuit Breaker State Machine</text></g><path d="M174,154.6094 L651.3628,154.6094 A12.5,12.5 0 0 1 663.8628,167.1094 L663.8628,180.9063 L161.5,180.9063 L161.5,167.1094 A12.5,12.5 0 0 1 174,154.6094" fill="#FFFFFF"/><path d="M161.5,180.9063 L663.8628,180.9063 L663.8628,310.6406 A12.5,12.5 0 0 1 651.3628,323.1406 L174,323.1406 A12.5,12.5 0 0 1 161.5,310.6406 L161.5,180.9063" fill="#FFFFFF"/><rect fill="none" height="168.5313" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="502.3628" x="161.5" y="154.6094"/><line style="stroke:#000000;stroke-width:1;" x1="161.5" x2="663.8628" y1="180.9063" y2="180.9063"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="57.1074" x="384.1277" y="172.6045">CLOSED</text><ellipse cx="243" cy="201.9063" fill="#FFFFFF" rx="10" ry="10" style="stroke:#000000;stroke-width:1;"/><g id="CLOSED.Monitoring"><rect fill="#FFFFFF" height="64.2344" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="139.3965" x="173.5" y="248.9063"/><line style="stroke:#000000;stroke-width:1;" x1="173.5" x2="312.8965" y1="275.2031" y2="275.2031"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="74.8672" x="205.7646" y="266.9014">Monitoring</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="103.3418" x="178.5" y="291.3418">failure_count = 0</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="119.3965" x="178.5" y="305.3105">Monitor all requests</text></g><!--link *start*CLOSED to Monitoring--><g class="link" data-entity-1=".start.CLOSED" data-entity-2="Monitoring" data-source-line="8" data-uid="lnk6" id="link_.start.CLOSED_Monitoring"><path d="M243,212.0463 C243,221.1263 243,229.5763 243,242.8163" fill="none" id="*start*CLOSED-to-Monitoring" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="243,248.8163,247,239.8163,243,243.8163,239,239.8163,243,248.8163" style="stroke:#000000;stroke-width:1;"/></g><!--link Monitoring to Monitoring--><g class="link" data-entity-1="Monitoring" data-entity-2="Monitoring" data-source-line="12" data-uid="lnk7" id="link_Monitoring_Monitoring"><path d="M312.67,276.6363 C323.29,277.2863 330.5,278.7063 330.5,280.9063 C330.5,283.1063 329.2788,284.1597 318.6588,284.8097" fill="none" id="Monitoring-to-Monitoring" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="312.67,285.1763,321.8976,288.619,317.6607,284.8708,321.4088,280.6339,312.67,285.1763" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="52.3301" x="378.1851" y="277.9731">Success</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135.7002" x="336.5" y="293.106">[Reset failure_count]</text></g><!--link Monitoring to Monitoring--><g class="link" data-entity-1="Monitoring" data-entity-2="Monitoring" data-source-line="13" data-uid="lnk8" id="link_Monitoring_Monitoring"><path d="M312.67,272.8663 C383.02,269.6163 477.5,272.2963 477.5,280.9063 C477.5,289.5163 389.0136,292.4731 318.6636,289.2231" fill="none" id="Monitoring-to-Monitoring-1" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="312.67,288.9462,321.4758,293.3573,317.6647,289.177,321.845,285.3658,312.67,288.9462" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="44.2495" x="544.0566" y="277.9731">Failure</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="165.3628" x="483.5" y="293.106">[Increment failure_count]</text></g><path d="M24.5,415.6094 L328.3652,415.6094 A12.5,12.5 0 0 1 340.8652,428.1094 L340.8652,441.9063 L12,441.9063 L12,428.1094 A12.5,12.5 0 0 1 24.5,415.6094" fill="#FFFFFF"/><path d="M12,441.9063 L340.8652,441.9063 L340.8652,674.4063 A12.5,12.5 0 0 1 328.3652,686.9063 L24.5,686.9063 A12.5,12.5 0 0 1 12,674.4063 L12,441.9063" fill="#FFFFFF"/><rect fill="none" height="271.2969" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="328.8652" x="12" y="415.6094"/><line style="stroke:#000000;stroke-width:1;" x1="12" x2="340.8652" y1="441.9063" y2="441.9063"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="38.7803" x="157.0425" y="433.6045">OPEN</text><ellipse cx="128.5" cy="462.9063" fill="#FFFFFF" rx="10" ry="10" style="stroke:#000000;stroke-width:1;"/><g id="OPEN.Rejecting"><rect fill="#FFFFFF" height="64.2344" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="209.0117" x="24" y="509.9063"/><line style="stroke:#000000;stroke-width:1;" x1="24" x2="233.0117" y1="536.2031" y2="536.2031"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="65.6797" x="95.666" y="527.9014">Rejecting</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="121.0547" x="29" y="552.3418">Fast fail all requests</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="189.0117" x="29" y="566.3105">Return ServiceUnavailableError</text></g><g id="OPEN.CheckTimeout"><rect fill="#FFFFFF" height="50" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="120.6865" x="68" y="626.9063"/><line style="stroke:#000000;stroke-width:1;" x1="68" x2="188.6865" y1="653.2031" y2="653.2031"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="100.6865" x="78" y="644.9014">CheckTimeout</text></g><!--link *start*OPEN to Rejecting--><g class="link" data-entity-1=".start.OPEN" data-entity-2="Rejecting" data-source-line="19" data-uid="lnk12" id="link_.start.OPEN_Rejecting"><path d="M128.5,473.0463 C128.5,482.1263 128.5,490.5762 128.5,503.8162" fill="none" id="*start*OPEN-to-Rejecting" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="128.5,509.8162,132.5,500.8162,128.5,504.8162,124.5,500.8162,128.5,509.8162" style="stroke:#000000;stroke-width:1;"/></g><!--link Rejecting to CheckTimeout--><g class="link" data-entity-1="Rejecting" data-entity-2="CheckTimeout" data-source-line="23" data-uid="lnk14" id="link_Rejecting_CheckTimeout"><path d="M49.79,574.1163 C37.3,583.7463 30.95,595.4163 39.5,608.9063 C46.27,619.5863 51.2701,624.7649 62.4801,630.7649" fill="none" id="Rejecting-to-CheckTimeout" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="67.77,633.5963,61.7227,625.8226,63.3617,631.2368,57.9475,632.8758,67.77,633.5963" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="156.0889" x="40.5" y="604.9731">Check recovery timeout</text></g><!--link CheckTimeout to Rejecting--><g class="link" data-entity-1="CheckTimeout" data-entity-2="Rejecting" data-source-line="24" data-uid="lnk15" id="link_CheckTimeout_Rejecting"><path d="M181.66,626.8563 C187.99,621.8263 193.58,615.8763 197.5,608.9063 C204.73,596.0463 203.0362,588.1751 191.9562,578.1351" fill="none" id="CheckTimeout-to-Rejecting" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="187.51,574.1063,191.4934,583.1136,191.2151,577.4636,196.8652,577.1854,187.51,574.1063" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="129.3652" x="201.5" y="604.9731">timeout not expired</text></g><path d="M100,778.6094 L695.3296,778.6094 A12.5,12.5 0 0 1 707.8296,791.1094 L707.8296,804.9063 L87.5,804.9063 L87.5,791.1094 A12.5,12.5 0 0 1 100,778.6094" fill="#FFFFFF"/><path d="M87.5,804.9063 L707.8296,804.9063 L707.8296,934.6406 A12.5,12.5 0 0 1 695.3296,947.1406 L100,947.1406 A12.5,12.5 0 0 1 87.5,934.6406 L87.5,804.9063" fill="#FFFFFF"/><rect fill="none" height="168.5313" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="620.3296" x="87.5" y="778.6094"/><line style="stroke:#000000;stroke-width:1;" x1="87.5" x2="707.8296" y1="804.9063" y2="804.9063"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="81.7373" x="356.7961" y="796.6045">HALF_OPEN</text><ellipse cx="181.5" cy="825.9063" fill="#FFFFFF" rx="10" ry="10" style="stroke:#000000;stroke-width:1;"/><g id="HALF_OPEN.Testing"><rect fill="#FFFFFF" height="64.2344" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1;" width="164.1934" x="99.5" y="872.9063"/><line style="stroke:#000000;stroke-width:1;" x1="99.5" x2="263.6934" y1="899.2031" y2="899.2031"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="51.5977" x="155.7979" y="890.9014">Testing</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="144.1934" x="104.5" y="915.3418">half_open_attempts = 0</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="133.1895" x="104.5" y="929.3105">Allow limited requests</text></g><!--link *start*HALF_OPEN to Testing--><g class="link" data-entity-1=".start.HALF_OPEN" data-entity-2="Testing" data-source-line="30" data-uid="lnk19" id="link_.start.HALF_OPEN_Testing"><path d="M181.5,836.0463 C181.5,845.1263 181.5,853.5763 181.5,866.8163" fill="none" id="*start*HALF_OPEN-to-Testing" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="181.5,872.8163,185.5,863.8163,181.5,867.8163,177.5,863.8163,181.5,872.8163" style="stroke:#000000;stroke-width:1;"/></g><!--link Testing to Testing--><g class="link" data-entity-1="Testing" data-entity-2="Testing" data-source-line="34" data-uid="lnk20" id="link_Testing_Testing"><path d="M263.88,900.7963 C274.49,901.5063 281.5,902.8763 281.5,904.9063 C281.5,906.9363 280.4766,907.9056 269.8666,908.6156" fill="none" id="Testing-to-Testing" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="263.88,909.0163,273.127,912.4064,268.8688,908.6824,272.5928,904.4243,263.88,909.0163" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="52.3301" x="366.1443" y="901.9731">Success</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="209.6187" x="287.5" y="917.106">[Increment half_open_attempts]</text></g><!--link Testing to Testing--><g class="link" data-entity-1="Testing" data-entity-2="Testing" data-source-line="35" data-uid="lnk21" id="link_Testing_Testing"><path d="M263.7,897.1963 C360.14,893.4463 502.5,896.0163 502.5,904.9063 C502.5,913.7963 366.1355,916.5994 269.6955,912.8494" fill="none" id="Testing-to-Testing-1" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="263.7,912.6163,272.5378,916.9629,268.6962,912.8105,272.8486,908.969,263.7,912.6163" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="44.2495" x="578.54" y="901.9731">Failure</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="184.3296" x="508.5" y="917.106">[Back to OPEN immediately]</text></g><ellipse cx="412.5" cy="67.6094" fill="#FFFFFF" rx="10" ry="10" style="stroke:#000000;stroke-width:1;"/><g class="entity" data-entity="GMN2" data-source-line="42" data-uid="ent0003" id="entity_GMN2"><path d="M699,219.1094 L699,235.1094 L663.83,239.1094 L699,243.1094 L699,259.375 A0,0 0 0 0 699,259.375 L833.8135,259.375 A0,0 0 0 0 833.8135,259.375 L833.8135,229.1094 L823.8135,219.1094 L699,219.1094 A0,0 0 0 0 699,219.1094" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M823.8135,219.1094 L823.8135,229.1094 L833.8135,229.1094 L823.8135,219.1094" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="113.8135" x="705" y="236.1763">Normal operation</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="88.1816" x="705" y="251.3091">Track failures</text></g><g class="entity" data-entity="GMN5" data-source-line="47" data-uid="ent0006" id="entity_GMN5"><path d="M376,531.1094 L376,547.1094 L341.11,551.1094 L376,555.1094 L376,571.375 A0,0 0 0 0 376,571.375 L579.2285,571.375 A0,0 0 0 0 579.2285,571.375 L579.2285,541.1094 L569.2285,531.1094 L376,531.1094 A0,0 0 0 0 376,531.1094" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M569.2285,531.1094 L569.2285,541.1094 L579.2285,541.1094 L569.2285,531.1094" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="182.2285" x="382" y="548.1763">Protect downstream service</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="110.5254" x="382" y="563.3091">No requests sent</text></g><g class="entity" data-entity="GMN8" data-source-line="52" data-uid="ent0009" id="entity_GMN8"><path d="M742.5,843.1094 L742.5,859.1094 L707.89,863.1094 L742.5,867.1094 L742.5,883.375 A0,0 0 0 0 742.5,883.375 L924.1909,883.375 A0,0 0 0 0 924.1909,883.375 L924.1909,853.1094 L914.1909,843.1094 L742.5,843.1094 A0,0 0 0 0 742.5,843.1094" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M914.1909,843.1094 L914.1909,853.1094 L924.1909,853.1094 L914.1909,843.1094" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="160.6909" x="748.5" y="860.1763">Test if service recovered</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="138.8486" x="748.5" y="875.3091">Limited trial requests</text></g><!--link *start* to CLOSED--><g class="link" data-entity-1=".start." data-entity-2="CLOSED" data-source-line="5" data-uid="lnk3" id="link_.start._CLOSED"><path d="M412.5,77.7194 C412.5,92.6394 412.5,117.7294 412.5,148.5894" fill="none" id="*start*-to-CLOSED" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="412.5,154.5894,416.5,145.5894,412.5,149.5894,408.5,145.5894,412.5,154.5894" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="74.5151" x="413.5" y="120.6763">Initial State</text></g><!--link CLOSED to OPEN--><g class="link" data-entity-1="CLOSED" data-entity-2="OPEN" data-source-line="16" data-uid="lnk9" id="link_CLOSED_OPEN"><path d="M348.64,323.9994 C327.2,352.1494 306.3646,379.5255 282.7246,410.5755" fill="none" id="CLOSED-to-OPEN" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="279.09,415.3494,287.7245,410.6116,282.1188,411.3712,281.3593,405.7655,279.09,415.3494" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="176.084" x="324.5" y="366.6763">failure_count &gt;= threshold</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="142.7905" x="341.1467" y="381.8091">[Set last_failure_time]</text></g><!--link OPEN to HALF_OPEN--><g class="link" data-entity-1="OPEN" data-entity-2="HALF_OPEN" data-source-line="27" data-uid="lnk16" id="link_OPEN_HALF_OPEN"><path d="M154.7,686.7694 C156.59,708.5894 162.11,730.0794 173.5,748.6094 C180.23,759.5694 184.1125,765.3019 193.2725,774.3119" fill="none" id="OPEN-to-HALF_OPEN" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="197.55,778.5194,193.9387,769.3565,193.9854,775.0131,188.3287,775.0598,197.55,778.5194" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="167.6162" x="180.6699" y="729.6763">recovery_timeout expired</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="179.9561" x="174.5" y="744.8091">[Reset half_open_attempts]</text></g><!--link HALF_OPEN to OPEN--><g class="link" data-entity-1="HALF_OPEN" data-entity-2="OPEN" data-source-line="39" data-uid="lnk23" id="link_HALF_OPEN_OPEN"><path d="M383.76,778.3294 C378,757.1994 369.89,735.2394 358.5,716.6094 C352.22,706.3494 348.8386,701.0402 341.1686,691.3702" fill="none" id="HALF_OPEN-to-OPEN" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="337.44,686.6694,339.899,696.2063,340.5471,690.5867,346.1667,691.2349,337.44,686.6694" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="70.3066" x="390.2644" y="729.6763">Any failure</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="101.8354" x="374.5" y="744.8091">[Reset timeout]</text></g><!--link HALF_OPEN to CLOSED--><g class="link" data-entity-1="HALF_OPEN" data-entity-2="CLOSED" data-source-line="38" data-uid="lnk22" id="link_HALF_OPEN_CLOSED"><path d="M524.98,778.4294 C553.84,752.7094 580.63,721.7694 596.5,686.6094 C646.06,576.8294 643.9,526.3294 596.5,415.6094 C581.64,380.9094 560.5332,353.9591 533.2132,327.9191" fill="none" id="HALF_OPEN-to-CLOSED" style="stroke:#000000;stroke-width:1;"/><polygon fill="#000000" points="528.87,323.7794,532.625,332.8843,532.4893,327.2291,538.1445,327.0934,528.87,323.7794" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="167.1021" x="633.5" y="548.1763">half_open_attempts &gt;= 3</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="127.2896" x="653.4063" y="563.3091">[Reset all counters]</text></g><!--SRC=[XLHTRzim37pNh-1U2nGOiBS1BP1sALOW_K3SFNM1eSfChLMMCefE5mpxxwDjsOwJ5dspvBiZUJpx4vTO8MoSjbufjkmGBYsPsZ9S4EeN9CXOCyADDgNrgDJZoGfEJy_XSd6NpR_1LxZsbgrs7KwfsCBJsxyAe2VS1046ilvPBiU3AAorTJLXRaBj6SxWyo4W7K0x1uI_QumS1JE5JMi8AwkDmHX_-iSbHkHfcTK7vAiEBEHhRqXCyaS2_vHAOpRik_lvxT4ivsV09M4iWoj4AfCkd8wSzoYs5Qvwprg5VSUM-0iDTuODpsrliMlcq91zq1Av9WyPqjOQ_E7rLWZwoU6SA53dteXlDrgYUNcGZaBD8j0UHTs4BT8Ek7iXh0bkqgUm4WnyOC0_6qjOD4QripNOxxF5LPwywhNpdfG8myPAxTPvsA3FDJDM6uw3MQFElcCFOaJdLtgIAiSYAM8ZPEPSU0LdAyjO72IiH-t9Jx8rnkEjRj_ZZ_6wqE8oXsxxjggmi3AVsxNv6gUSV79lZ2H9-pBuriIY3I2Iz30LITxF_AxFwa1BQn2FPNi8P9zBXh1ETMMMsq2LVEbIcJJRu9lngEa_AKM5lcXMZuSIJLL1tvFS6eOYlFh8yeEf87O1RTK7w-NMyxjYmq39Nh3hNgRFbAGEO94MojJyduQr3hB_0G00]--></g></svg>