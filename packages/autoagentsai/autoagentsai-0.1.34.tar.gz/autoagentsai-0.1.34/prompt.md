


# æ¨¡å—ä½¿ç”¨æŒ‡å—

## åŸºç¡€ç”¨æ³•

### åˆ›å»ºFlowGraphå®ä¾‹
```python
from src.autoagentsai.graph.FlowGraph import FlowGraph

# åˆ›å»ºFlowGraphå®ä¾‹ï¼ˆå¿…éœ€è®¤è¯å‚æ•°ï¼‰
graph = FlowGraph(
    personal_auth_key="your_auth_key",
    personal_auth_secret="your_auth_secret", 
    base_url="https://uat.agentspro.cn"  # å¯é€‰ï¼Œæœ‰é»˜è®¤å€¼
)
```

### æ·»åŠ èŠ‚ç‚¹çš„åŸºæœ¬è¯­æ³•
```python
graph.add_node(
    node_id="èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†",           # å¿…éœ€ï¼šèŠ‚ç‚¹IDï¼Œåœ¨æ•´ä¸ªæµç¨‹ä¸­å”¯ä¸€
    module_type="æ¨¡å—ç±»å‹",          # å¿…éœ€ï¼šæ¨¡å—ç±»å‹ï¼Œè§ä¸‹é¢è¯¦ç»†è¯´æ˜
    position={"x": 100, "y": 100},   # å¿…éœ€ï¼šèŠ‚ç‚¹åœ¨ç”»å¸ƒä¸Šçš„ä½ç½®
    inputs={                         # å¯é€‰ï¼šè¾“å…¥å‚æ•°é…ç½®
        "å‚æ•°å": "å‚æ•°å€¼"
    }
)
```

### æ·»åŠ è¿æ¥è¾¹
```python
graph.add_edge(
    source="æºèŠ‚ç‚¹ID",
    target="ç›®æ ‡èŠ‚ç‚¹ID", 
    source_handle="æºè¾“å‡ºç«¯å£",     # å¯é€‰ï¼Œé»˜è®¤""
    target_handle="ç›®æ ‡è¾“å…¥ç«¯å£"    # å¯é€‰ï¼Œé»˜è®¤""
)
```

### ç¼–è¯‘å’Œéƒ¨ç½²
```python
graph.compile(
    name="æ™ºèƒ½ä½“åç§°",              # å¯é€‰ï¼Œé»˜è®¤"æœªå‘½åæ™ºèƒ½ä½“"
    avatar="å¤´åƒURL",              # å¯é€‰ï¼Œæœ‰é»˜è®¤å¤´åƒ
    intro="æ™ºèƒ½ä½“ä»‹ç»",            # å¯é€‰
    category="åˆ†ç±»",               # å¯é€‰
    prologue="å¼€åœºç™½"              # å¯é€‰
)
```

---

## æ¨¡å—è¯¦ç»†è¯´æ˜

## 1. ç”¨æˆ·æé—®ï¼ˆquestionInputï¼‰

### ğŸ“Œ æ¨¡å—åŠŸèƒ½è¯´æ˜
ç”¨äºä¸»åŠ¨å‘ç”¨æˆ·è¯·æ±‚è¾“å…¥ä¿¡æ¯ã€‚æ”¯æŒçš„è¾“å…¥ç±»å‹åŒ…æ‹¬æ–‡æœ¬ã€æ–‡æ¡£å’Œå›¾ç‰‡ï¼ˆä¸å¯åŒæ—¶é€‰æ‹©å›¾ç‰‡å’Œæ–‡æ¡£ï¼‰ã€‚è¯¥æ¨¡å—é€šå¸¸ä¸ºæµç¨‹çš„èµ·ç‚¹ï¼Œä¹Ÿå¯åœ¨ä»»æ„èŠ‚ç‚¹åç”¨äºå†æ¬¡è·å–ç”¨æˆ·è¾“å…¥ã€‚æ¨¡å—æœ¬èº«ä¸æ‰§è¡Œä»»ä½•æ™ºèƒ½å¤„ç†ï¼Œä»…è´Ÿè´£é‡‡é›†ç”¨æˆ·æ•°æ®ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ä¸‹æ¸¸æ¨¡å—ä½¿ç”¨ã€‚

### ğŸ“ SDKä½¿ç”¨æ–¹æ³•

```python
graph.add_node(
    node_id="user_input",
    module_type="questionInput",
    position={"x": 100, "y": 100},
    inputs={
        # åŸºç¡€å¼€å…³é…ç½®
        "inputText": True,          # æ˜¯å¦å¯ç”¨æ–‡æœ¬è¾“å…¥ï¼ˆé»˜è®¤Trueï¼‰
        "uploadFile": False,        # æ˜¯å¦å¯ç”¨æ–‡æ¡£ä¸Šä¼ ï¼ˆé»˜è®¤Falseï¼‰
        "uploadPicture": False,     # æ˜¯å¦å¯ç”¨å›¾ç‰‡ä¸Šä¼ ï¼ˆé»˜è®¤Falseï¼‰
        
        # é«˜çº§åŠŸèƒ½å¼€å…³
        "fileUpload": False,        # æ˜¯å¦å¯ç”¨æ–‡æ¡£å®¡æŸ¥åŠŸèƒ½ï¼ˆé»˜è®¤Falseï¼‰
        "fileContrast": False,      # æ˜¯å¦å¯ç”¨æ–‡æ¡£æ¯”å¯¹åŠŸèƒ½ï¼ˆé»˜è®¤Falseï¼‰
        "fileInfo": [],             # æ–‡æ¡£åˆ†ç»„ä¿¡æ¯ï¼ˆä»…æ–‡æ¡£æ¯”å¯¹æ—¶ä½¿ç”¨ï¼‰
        "initialInput": True        # æ˜¯å¦ä½œä¸ºåˆå§‹è¾“å…¥ï¼ˆé»˜è®¤Trueï¼‰
    }
)
```
### ğŸ”¶ å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|-------|------|
| `inputText` | boolean | `True` | æ˜¯å¦å¯ç”¨æ–‡æœ¬è¾“å…¥åŠŸèƒ½ |
| `uploadFile` | boolean | `False` | æ˜¯å¦å¯ç”¨æ–‡æ¡£ä¸Šä¼ åŠŸèƒ½ |
| `uploadPicture` | boolean | `False` | æ˜¯å¦å¯ç”¨å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ |
| `fileUpload` | boolean | `False` | æ˜¯å¦å¯ç”¨æ–‡æ¡£å®¡æŸ¥åŠŸèƒ½ |
| `fileContrast` | boolean | `False` | æ˜¯å¦å¯ç”¨æ–‡æ¡£æ¯”å¯¹åŠŸèƒ½ |
| `fileInfo` | list | `[]` | æ–‡æ¡£åˆ†ç»„ä¿¡æ¯ï¼ˆä»…æ–‡æ¡£æ¯”å¯¹æ—¶ä½¿ç”¨ï¼‰ |
| `initialInput` | boolean | `True` | æ˜¯å¦ä½œä¸ºåˆå§‹æµç¨‹è¾“å…¥ |

### ğŸ”· è¾“å‡ºå˜é‡ï¼ˆå¯åœ¨åç»­æ¨¡å—ä¸­å¼•ç”¨ï¼‰

| å˜é‡å | ç±»å‹ | è¯´æ˜ |
|-------|------|------|
| `{{userChatInput}}` | string | ç”¨æˆ·æ–‡æœ¬è¾“å…¥å†…å®¹ |
| `{{files}}` | file | ç”¨æˆ·ä¸Šä¼ çš„æ–‡æ¡£åˆ—è¡¨ |
| `{{images}}` | image | ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡åˆ—è¡¨ |
| `{{unclickedButton}}` | boolean | ç”¨æˆ·æ˜¯å¦æœªç‚¹å‡»æŒ‰é’® |
| `{{finish}}` | boolean | æ¨¡å—è¿è¡Œå®Œæˆæ ‡å¿— |

### âœ… ä½¿ç”¨è§„åˆ™ä¸é™åˆ¶

- **äº’æ–¥é™åˆ¶**ï¼š`uploadFile` å’Œ `uploadPicture` ä¸èƒ½åŒæ—¶ä¸º `True`
- **æ–‡æ¡£åŠŸèƒ½**ï¼šå¦‚éœ€æ–‡æ¡£å®¡æŸ¥æˆ–æ¯”å¯¹ï¼Œéœ€åŒæ—¶å¼€å¯ `fileUpload` æˆ– `fileContrast`
- **è¿æ¥è¦æ±‚**ï¼šé€šå¸¸ä½œä¸ºæµç¨‹èµ·ç‚¹ï¼Œéœ€è¦è¿æ¥ `{{finish}}` åˆ°ä¸‹æ¸¸æ¨¡å—
- **æ•°æ®ä¼ é€’**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿æ¥ç›¸åº”è¾“å‡ºå˜é‡åˆ°ä¸‹æ¸¸æ¨¡å—

### ğŸ§  å¸¸ç”¨é…ç½®ç¤ºä¾‹

```python
# ç¤ºä¾‹1ï¼šçº¯æ–‡æœ¬è¾“å…¥
graph.add_node(
    node_id="text_input",
    module_type="questionInput", 
    position={"x": 100, "y": 100},
    inputs={
        "inputText": True,
        "uploadFile": False,
        "uploadPicture": False
    }
)

# ç¤ºä¾‹2ï¼šæ–‡æ¡£ä¸Šä¼  + æ–‡æœ¬è¾“å…¥
graph.add_node(
    node_id="doc_input",
    module_type="questionInput",
    position={"x": 100, "y": 100}, 
    inputs={
        "inputText": True,
        "uploadFile": True,      # å¼€å¯æ–‡æ¡£ä¸Šä¼ 
        "uploadPicture": False,  # å¿…é¡»å…³é—­å›¾ç‰‡ä¸Šä¼ 
        "fileUpload": True       # å¼€å¯æ–‡æ¡£å®¡æŸ¥
    }
)

# ç¤ºä¾‹3ï¼šå›¾ç‰‡ä¸Šä¼  + æ–‡æœ¬è¾“å…¥
graph.add_node(
    node_id="image_input",
    module_type="questionInput",
    position={"x": 100, "y": 100},
    inputs={
        "inputText": True,
        "uploadFile": False,     # å¿…é¡»å…³é—­æ–‡æ¡£ä¸Šä¼ 
        "uploadPicture": True    # å¼€å¯å›¾ç‰‡ä¸Šä¼ 
    }
)
```

---

## 2. æ™ºèƒ½å¯¹è¯ï¼ˆaiChatï¼‰

### ğŸ“Œ æ¨¡å—åŠŸèƒ½è¯´æ˜
è¯¥æ¨¡å—é€šè¿‡æ¥å…¥å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ï¼Œå®ç°æ™ºèƒ½é—®ç­”ã€å†…å®¹ç”Ÿæˆã€ä¿¡æ¯åŠ å·¥ç­‰åŠŸèƒ½ã€‚å®ƒæ¥å—ç”¨æˆ·æ–‡æœ¬è¾“å…¥ã€å›¾ç‰‡ä¿¡æ¯ã€çŸ¥è¯†åº“å†…å®¹ç­‰å¤šç§ä¿¡æ¯æ¥æºï¼Œå¹¶æ ¹æ®é…ç½®çš„æç¤ºè¯ï¼ˆPromptï¼‰ä¸å‚æ•°è®¾ç½®è¿”å› AI ç”Ÿæˆçš„å†…å®¹ï¼Œå¸¸ç”¨äºå›å¤ç”¨æˆ·é—®é¢˜æˆ–åŠ å·¥ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

### ğŸ“ SDKä½¿ç”¨æ–¹æ³•

```python
graph.add_node(
    node_id="ai_chat",
    module_type="aiChat",
    position={"x": 300, "y": 100},
    inputs={
        # æ¨¡å‹åŸºç¡€é…ç½®
        "model": "glm-4-airx",                 # é€‰æ‹©LLMæ¨¡å‹ï¼ˆå¿…å¡«ï¼‰
        "quotePrompt": "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹...",     # æç¤ºè¯ï¼ˆå¯é€‰ï¼‰
        
        # è¾“å…¥æ•°æ®é…ç½®ï¼ˆé€šè¿‡å˜é‡å¼•ç”¨ï¼‰
        "text": "{{userChatInput}}",           # æ–‡æœ¬è¾“å…¥ï¼ˆé€šå¸¸è¿æ¥ç”¨æˆ·è¾“å…¥ï¼‰
        "images": "{{images}}",                # å›¾ç‰‡è¾“å…¥ï¼ˆå¯é€‰ï¼‰
        "knSearch": "{{quoteQA}}",             # çŸ¥è¯†åº“æœç´¢ç»“æœï¼ˆå¯é€‰ï¼‰
        
        # æ¨¡å‹å‚æ•°é…ç½®
        "temperature": 0.1,                    # åˆ›æ„æ€§æ§åˆ¶ (0-1)
        "maxToken": 3000,                      # å›å¤å­—æ•°ä¸Šé™
        "stream": True,                        # æ˜¯å¦å¯¹ç”¨æˆ·å¯è§
        "historyText": 3,                      # ä¸Šä¸‹æ–‡è½®æ•° (0-6)
        
        # é«˜çº§é…ç½®
        "knConfig": "ä½¿ç”¨æ£€ç´¢åˆ°çš„å†…å®¹å›ç­”é—®é¢˜"     # çŸ¥è¯†åº“é«˜çº§é…ç½®ï¼ˆå¯é€‰ï¼‰
    }
)
```

### ğŸ”· è¾“å‡ºå˜é‡ï¼ˆå¯åœ¨åç»­æ¨¡å—ä¸­å¼•ç”¨ï¼‰

| å˜é‡å | ç±»å‹ | è¯´æ˜ |
|-------|------|------|
| `{{answerText}}` | string | AIç”Ÿæˆçš„å›å¤å†…å®¹ |
| `{{isResponseAnswerText}}` | boolean | æ¨¡å‹å¤„ç†å®Œæˆæ ‡å¿— |
| `{{finish}}` | boolean | æ¨¡å—è¿è¡Œå®Œæˆæ ‡å¿— |

âœ… ä½¿ç”¨è§„åˆ™ä¸é™åˆ¶
è¾“å…¥é¡¹è¿æ¥è¦æ±‚
æ¿€æ´»è¾“å…¥å¿…é¡»è‡³å°‘è¿æ¥ä¸€ä¸ªï¼š
switchï¼šä¸Šæ¸¸æ‰€æœ‰æ¨¡å—å®Œæˆæ—¶è§¦å‘
switchAnyï¼šä»»ä¸€ä¸Šæ¸¸å®Œæˆå³å¯è§¦å‘ï¼ˆæ¨èä½¿ç”¨ï¼‰
text é€šå¸¸ å¿…é¡»è¿æ¥ï¼Œç”¨äºæ¥æ”¶æ¥è‡ªç”¨æˆ·çš„æ–‡æœ¬è¾“å…¥ï¼ˆå¦‚ questionInput.userChatInputï¼‰ã€‚æœªè¿æ¥åˆ™æ¨¡å‹ç¼ºå°‘ä¸»è¦è¾“å…¥å†…å®¹ã€‚
å…¶ä»–å¯é€‰è¾“å…¥é¡¹è¯·æ ¹æ®ä¸šåŠ¡åœºæ™¯å†³å®šæ˜¯å¦è¿æ¥å’Œé…ç½®ï¼š
imagesï¼šå¦‚éœ€å¤„ç†ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ï¼Œåˆ™è¿æ¥ questionInput.images
knSearchï¼šå¦‚éœ€èåˆçŸ¥è¯†åº“ä¿¡æ¯ï¼Œåˆ™è¿æ¥çŸ¥è¯†åº“æœç´¢ç»“æœ
knConfigï¼šå¦‚æœ‰çŸ¥è¯†åº“é«˜çº§é…ç½®éœ€æ±‚ï¼Œå¯è®¾ç½®æ§åˆ¶æ¨¡å‹è¡Œä¸ºï¼ˆå¦‚ç‰‡æ®µç­›é€‰ã€ç»“æ„åŒ–æ³¨å…¥ç­‰ï¼‰
historyTextï¼šè®¾ç½®æ¨¡å‹å¯è®¿é—®çš„å†å²å¯¹è¯è½®æ•°ï¼ˆ0~6ï¼‰ï¼Œæå‡å¤šè½®ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›
modelï¼šå¿…é¡»é…ç½®ï¼Œå†³å®šä½¿ç”¨å“ªç§ LLMï¼Œæ”¯æŒä¸åŒæ¨¡å‹ç­–ç•¥é€‰æ‹©
quotePromptï¼šå¯é…ç½®ä¸ºæ¨¡å‹å›ºå®šè¾“å…¥å‰ç¼€ï¼Œå¼•å¯¼è¯­æ°”ã€èº«ä»½ã€é™åˆ¶èŒƒå›´ç­‰
streamï¼šè‹¥å¼€å¯ï¼Œè¡¨ç¤ºå›å¤å†…å®¹å°†å±•ç¤ºç»™ç”¨æˆ·ï¼ˆå¯¹è¯ç±»åœºæ™¯åº”å¼€å¯ï¼‰
temperatureã€maxTokenï¼šå¯è°ƒèŠ‚åˆ›æ„æ€§ä¸å›å¤é•¿åº¦ï¼Œé»˜è®¤ä¿å®ˆè®¾ç½®å³å¯
è¾“å‡ºé¡¹è¿æ¥å»ºè®®
å¿…é¡»è¿æ¥ finish è¾“å‡º è‡³ä¸‹æ¸¸æ¨¡å—çš„ switchAnyï¼Œç”¨äºè§¦å‘åç»­æµç¨‹æ‰§è¡Œ
answerText è¾“å‡ºä¸ºæ¨¡å‹ç”Ÿæˆçš„å›å¤å†…å®¹ï¼š
å¦‚éœ€å±•ç¤ºç»™ç”¨æˆ·ï¼ˆå¦‚ UI æ¸²æŸ“ï¼‰ï¼Œå¯è¿æ¥å±•ç¤ºæ¨¡å—æˆ–è¾“å‡ºç«¯
å¦‚ä»…ä¸ºä¸­é—´å¤„ç†ç»“æœï¼Œå¯æŒ‰éœ€ä¼ é€’åˆ°åç»­é€»è¾‘æ¨¡å—
isResponseAnswerText è¡¨ç¤ºå¤„ç†ç»“æŸçš„å¦ä¸€æ ‡å¿—ä¿¡å·ï¼Œå¯é€‰è¿æ¥ï¼Œä¾¿äºæ›´ç²¾ç»†çš„æ§åˆ¶

ğŸ§  SOPè®¾è®¡å»ºè®®
å…¸å‹ç”¨æ³•ï¼š åœ¨ç”¨æˆ·è¾“å…¥åæ¥å…¥æ­¤æ¨¡å—ï¼Œç”¨äºå¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤å†…å®¹
ä¸Šæ¸¸è§¦å‘ï¼š é€šå¸¸ç”± questionInput æ¨¡å—çš„ finish æ¿€æ´»ï¼ŒåŒæ—¶è¿æ¥ç”¨æˆ·è¾“å…¥ä½œä¸º text è¾“å…¥
å›å¤ç”Ÿæˆï¼š
é»˜è®¤å»ºè®®å¼€å¯ streamï¼Œç›´æ¥å°†æ¨¡å‹å›å¤æ˜¾ç¤ºç»™ç”¨æˆ·
è‹¥ä¸ºä¸­é—´å¤„ç†ç”¨é€”ï¼ˆå¦‚æ–‡æœ¬åˆ†æã€æ‘˜è¦æŠ½å–ç­‰ï¼‰ï¼Œå¯å…³é—­ streamï¼Œå¹¶æŒ‰éœ€ä¼ é€’ answerText åˆ°ä¸‹ä¸€æ¨¡å—
çŸ¥è¯†èåˆï¼š è‹¥ä¸šåŠ¡æ¶‰åŠçŸ¥è¯†åº“æ£€ç´¢æˆ–åµŒå…¥æ–‡æ¡£å†…å®¹ï¼Œå¯è¿æ¥ knSearch å’Œé…ç½® knConfig å‚æ•°
åˆ†æ®µå¤„ç†ï¼š å¤šè½®å¤šæ­¥éª¤å¤„ç†å¯ä¸²è”å¤šä¸ª aiChat æ¨¡å—ï¼Œé€‚å½“è®¾ç½® historyText å½¢æˆé€’è¿›å¼å¤„ç†é“¾è·¯
æ¨¡å—å¤ç”¨ï¼š å»ºè®®é€šè¿‡ Prompt å’Œæ¨¡å‹åˆ‡æ¢é€‚é…ä¸åŒè§’è‰²ä¸ä»»åŠ¡ï¼Œå¦‚æ€»ç»“ã€ç”Ÿæˆé‚®ä»¶ã€æ ¼å¼åŒ–å›å¤ç­‰
æ¿€æ´»ç­–ç•¥ï¼š æ¨èç»Ÿä¸€ä½¿ç”¨ switchAny æ¿€æ´»ä»¥å¢å¼ºå®¹é”™æ€§ï¼Œç¡®ä¿æ¨¡å—èƒ½è¢«æ­£å¸¸è§¦å‘æ‰§è¡Œ

## 3. HTTPè°ƒç”¨ï¼ˆhttpInvokeï¼‰

### ğŸ“Œ æ¨¡å—åŠŸèƒ½è¯´æ˜
è¯¥æ¨¡å—ç”¨äºå‘å¤–éƒ¨æœåŠ¡å‘èµ· HTTP è¯·æ±‚ï¼ˆå¦‚ GET / POST / PUT ç­‰ï¼‰ï¼Œå¹¶å°†è¿”å›ç»“æœä½œä¸ºæµç¨‹çš„ä¸€éƒ¨åˆ†è¿›è¡Œå¤„ç†ã€‚é€‚ç”¨äºè°ƒç”¨å¤–éƒ¨æ•°æ®åº“ã€æœç´¢æœåŠ¡ã€åˆ†ææœåŠ¡ç­‰ä¸€åˆ‡éœ€è¦è¿œç¨‹è¯·æ±‚çš„åœºæ™¯ã€‚

### ğŸ“ SDKä½¿ç”¨æ–¹æ³•

```python
graph.add_node(
    node_id="http_call",
    module_type="httpInvoke",
    position={"x": 400, "y": 100},
    inputs={
        # è¯·æ±‚é…ç½®
        "url": """post https://api.example.com/search
data-type json
token your_api_token
Content-Type application/json""",  # è¯·æ±‚åœ°å€å’Œé…ç½®
        
        # è¯·æ±‚ä½“ï¼ˆé€šè¿‡å˜é‡å¼•ç”¨ï¼‰
        "_requestBody_": "{{requestData}}"  # å®Œæ•´çš„POSTè¯·æ±‚ä½“JSONæ•°æ®
    }
)
```
### ğŸ”¶ å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | å¿…å¡« | è¯´æ˜ |
|-------|------|-------|------|------|
| `url` | string | `""` | âœ… | è¯·æ±‚é…ç½®ï¼ˆåŒ…å«æ–¹æ³•ã€åœ°å€ã€headersï¼‰ |
| `_requestBody_` | string | `""` | âŒ | POSTè¯·æ±‚ä½“çš„JSONæ•°æ®ï¼ˆå˜é‡å¼•ç”¨ï¼‰ |

### ğŸ”· è¾“å‡ºå˜é‡ï¼ˆå¯åœ¨åç»­æ¨¡å—ä¸­å¼•ç”¨ï¼‰

| å˜é‡å | ç±»å‹ | è¯´æ˜ |
|-------|------|------|
| `{{_success_}}` | boolean | è¯·æ±‚æˆåŠŸæ ‡å¿— |
| `{{_failed_}}` | boolean | è¯·æ±‚å¤±è´¥æ ‡å¿— |
| `{{_response_}}` | string | æ¥å£è¿”å›çš„åŸå§‹JSONå­—ç¬¦ä¸² |
| `{{finish}}` | boolean | æ¨¡å—è¿è¡Œå®Œæˆæ ‡å¿— |

### âœ… ä½¿ç”¨è§„åˆ™ä¸é™åˆ¶

- **URLé…ç½®æ ¼å¼**ï¼šå¿…é¡»æŒ‰ä»¥ä¸‹æ ¼å¼é…ç½®
  ```
  æ–¹æ³• åœ°å€
  data-type json
  token è®¤è¯ä»¤ç‰Œ
  headerå headerå€¼
  ```
- **æ”¯æŒçš„HTTPæ–¹æ³•**ï¼š`get`, `post`, `put`, `patch`, `delete`
- **æ•°æ®ç±»å‹**ï¼šæ¨èä½¿ç”¨ `json`ï¼Œä¹Ÿæ”¯æŒ `form`, `query`
- **è¯·æ±‚ä½“**ï¼šPOST/PUTè¯·æ±‚éœ€è¦é€šè¿‡ `_requestBody_` ä¼ å…¥JSONæ•°æ®
- **é™åˆ¶**ï¼šæš‚ä¸æ”¯æŒ form-dataã€æ–‡ä»¶ä¸Šä¼ ç­‰å¤æ‚æ ¼å¼

### ğŸ§  å¸¸ç”¨é…ç½®ç¤ºä¾‹

```python
# ç¤ºä¾‹1ï¼šGETè¯·æ±‚
graph.add_node(
    node_id="get_data",
    module_type="httpInvoke",
    position={"x": 300, "y": 100},
    inputs={
        "url": """get https://api.example.com/users
token Bearer abc123
Accept application/json"""
    }
)

# ç¤ºä¾‹2ï¼šPOSTè¯·æ±‚
graph.add_node(
    node_id="post_data", 
    module_type="httpInvoke",
    position={"x": 500, "y": 100},
    inputs={
        "url": """post https://api.example.com/users
data-type json
Authorization Bearer {{token}}
Content-Type application/json""",
        "_requestBody_": "{{userInfo}}"  # æ¥è‡ªä¸Šæ¸¸æ¨¡å—çš„JSONæ•°æ®
    }
)
```
ğŸ§  SOPè®¾è®¡å»ºè®®
ç”¨é€”å®šä½ï¼šé€‚ç”¨äºè°ƒç”¨å¤–éƒ¨æœåŠ¡ã€æ•°æ®åº“ã€æœç´¢å¼•æ“ã€å†…å®¹åˆ†ææ¥å£ç­‰
ä¸¾ä¾‹ï¼šç”¨æˆ·æé—® â†’ æå–å…³é”®è¯ â†’ HTTPæ¥å£æœç´¢å•†å“/æ³•è§„ â†’ è¿”å›ç»“æœäº¤ç»™å¤§æ¨¡å‹å¤„ç†æˆ–å±•ç¤º
å…¸å‹æµç¨‹ä½ç½®ï¼š
åœ¨ questionInput / aiChat è¾“å‡ºåæ’å…¥æ­¤æ¨¡å—ï¼Œä½œä¸ºâ€œæ•°æ®æŠ“å–ä¸­æ¢â€ä½¿ç”¨
æ¥æ”¶ç»“æ„åŒ–è¾“å…¥ â†’ å‘èµ·è¿œç¨‹è¯·æ±‚ â†’ è¾“å‡ºç»“æœäº¤ä¸‹æ¸¸å¤„ç†æˆ–å±•ç¤º
åˆ†æ”¯å¤„ç†ï¼š
æ¨èå°† _success_ / _failed_ åˆ†åˆ«è¿æ¥ä¸åŒåç»­æ¨¡å—ï¼Œå®ç°æµç¨‹å¥å£®æ€§æ§åˆ¶
å¦‚æˆåŠŸåè¿›å…¥ aiChat æ€»ç»“
å¤±è´¥åå¯é€šè¿‡é¢å¤–æ¨¡å—æç¤ºç”¨æˆ·â€œæ¥å£è°ƒç”¨å¤±è´¥â€
å¯æ‰©å±•æ€§å»ºè®®ï¼š
å°† url ä¸ requestBody åšå‚æ•°åŒ–æŠ½è±¡ï¼Œå¯ä»¥æé«˜å¤ç”¨æ€§ï¼ˆå¦‚ç”Ÿæˆä¸åŒç±»å‹æ¥å£è°ƒç”¨æ¨¡æ¿ï¼‰
è‹¥åç»­æ”¯æŒåŠ¨æ€ token / headerï¼Œå¯é€šè¿‡å˜é‡æ‹¼æ¥æ–¹å¼æ³¨å…¥ï¼ˆåœ¨ prompt æˆ–å‰ç½®æ¨¡å—ä¸­é¢„å¤„ç†ï¼‰
ç»“åˆä½¿ç”¨å»ºè®®ï¼š
é€šå¸¸ä¸ä»¥ä¸‹æ¨¡å—è”ç”¨ï¼š
questionInput æä¾›å‚æ•°æˆ–å…³é”®è¯
aiChat ç”Ÿæˆç»“æ„åŒ–è¯·æ±‚ä½“
aiChat / å±•ç¤ºæ¨¡å—å¤„ç†è¿”å›ç»“æœå¹¶å‘ˆç°

## 4. ç¡®å®šå›å¤ï¼ˆconfirmreplyï¼‰
### ğŸ“Œ æ¨¡å—åŠŸèƒ½è¯´æ˜
è¯¥æ¨¡å—ç”¨äºåœ¨æ»¡è¶³ç‰¹å®šè§¦å‘æ¡ä»¶æ—¶ï¼Œè¾“å‡ºä¸€æ®µé¢„è®¾çš„æ–‡æœ¬å†…å®¹æˆ–æ¥æ”¶å¹¶è½¬å‘æ¥è‡ªä¸Šæ¸¸æ¨¡å—çš„æ–‡æœ¬ç»“æœã€‚å¸¸ç”¨äºæç¤ºç¡®è®¤ã€ä¿¡æ¯å›æ˜¾ã€å¼•å¯¼æ€§å›å¤ç­‰æµç¨‹åœºæ™¯ä¸­ã€‚æ”¯æŒé™æ€é…ç½®å†…å®¹æˆ–åŠ¨æ€å†…å®¹è¾“å…¥ï¼Œé€‚é…å¤šç§ç”¨æˆ·äº¤äº’åœºæ™¯ã€‚

### ğŸ“ SDKä½¿ç”¨æ–¹æ³•

```python
graph.add_node(
    node_id="confirm_reply",
    module_type="confirmreply",
    position={"x": 600, "y": 100},
    inputs={
        # å›å¤å†…å®¹é…ç½®
        "text": "æ“ä½œå·²å®Œæˆï¼æ‚¨çš„è¯·æ±‚å·²æˆåŠŸå¤„ç†ã€‚",  # é™æ€æ–‡æœ¬
        # "text": "{{processResult}}",  # æˆ–ä½¿ç”¨å˜é‡å¼•ç”¨åŠ¨æ€å†…å®¹
        
        # å¯è§æ€§æ§åˆ¶
        "stream": True  # æ˜¯å¦å¯¹ç”¨æˆ·å¯è§ï¼ˆé»˜è®¤Trueï¼‰
    }
)
```

### ğŸ”¶ å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | å¿…å¡« | è¯´æ˜ |
|-------|------|-------|------|------|
| `text` | string | `"é»˜è®¤æç¤ºæ–‡æœ¬"` | âŒ | å›å¤å†…å®¹ï¼ˆæ”¯æŒå˜é‡å¼•ç”¨ï¼‰ |
| `stream` | boolean | `True` | âŒ | æ˜¯å¦å¯¹ç”¨æˆ·å¯è§ |

### ğŸ”· è¾“å‡ºå˜é‡ï¼ˆå¯åœ¨åç»­æ¨¡å—ä¸­å¼•ç”¨ï¼‰

| å˜é‡å | ç±»å‹ | è¯´æ˜ |
|-------|------|------|
| `{{text}}` | string | æ¨¡å—è¾“å‡ºçš„å›å¤å†…å®¹ |
| `{{finish}}` | boolean | æ¨¡å—è¿è¡Œå®Œæˆæ ‡å¿— |

### âœ… ä½¿ç”¨è§„åˆ™ä¸ç‰¹ç‚¹

- **å†…å®¹çµæ´»**ï¼šæ”¯æŒé™æ€æ–‡æœ¬æˆ–å˜é‡å¼•ç”¨åŠ¨æ€å†…å®¹
- **æ ¼å¼æ”¯æŒ**ï¼šæ”¯æŒ `\n` æ¢è¡Œç¬¦å’Œå˜é‡å ä½ç¬¦
- **å¯è§æ€§æ§åˆ¶**ï¼šé€šè¿‡ `stream` æ§åˆ¶æ˜¯å¦å¯¹ç”¨æˆ·å¯è§
- **å˜é‡è¦†ç›–**ï¼šå¤–éƒ¨è¾“å…¥ä¼šè¦†ç›–é™æ€é…ç½®çš„å†…å®¹

### ğŸ§  å¸¸ç”¨é…ç½®ç¤ºä¾‹

```python
# ç¤ºä¾‹1ï¼šé™æ€ç¡®è®¤å›å¤
graph.add_node(
    node_id="success_confirm",
    module_type="confirmreply",
    position={"x": 700, "y": 100},
    inputs={
        "text": "âœ… æ“ä½œæˆåŠŸå®Œæˆï¼\næ‚¨çš„è¯·æ±‚å·²å¤„ç†ã€‚",
        "stream": True
    }
)

# ç¤ºä¾‹2ï¼šåŠ¨æ€å†…å®¹å›å¤
graph.add_node(
    node_id="dynamic_reply",
    module_type="confirmreply", 
    position={"x": 800, "y": 200},
    inputs={
        "text": "å¤„ç†ç»“æœï¼š{{processResult}}\nçŠ¶æ€ï¼š{{status}}",
        "stream": True
    }
)

# ç¤ºä¾‹3ï¼šå†…éƒ¨æµè½¬ï¼ˆä¸æ˜¾ç¤ºç»™ç”¨æˆ·ï¼‰
graph.add_node(
    node_id="internal_log",
    module_type="confirmreply",
    position={"x": 900, "y": 300},
    inputs={
        "text": "å†…éƒ¨æ—¥å¿—ï¼š{{logMessage}}",
        "stream": False  # ä»…å†…éƒ¨ä½¿ç”¨ï¼Œä¸æ˜¾ç¤ºç»™ç”¨æˆ·
    }
)
```

---

## 5. çŸ¥è¯†åº“æœç´¢ï¼ˆknowledgesSearchï¼‰
### ğŸ“Œ æ¨¡å—åŠŸèƒ½è¯´æ˜
è¯¥æ¨¡å—ç”¨äºåœ¨å…³è”çš„çŸ¥è¯†åº“ä¸­è¿›è¡Œæœç´¢ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯æ™ºèƒ½åŒ¹é…ç›¸å…³å†…å®¹ï¼Œè¾…åŠ©æ™ºèƒ½å¯¹è¯æ¨¡å—æä¾›æ›´ç²¾å‡†çš„å›ç­”ã€‚æ”¯æŒç›¸ä¼¼åº¦é˜ˆå€¼è®¾ç½®ã€é‡æ’åºæ¨¡å‹ä¼˜åŒ–å’Œå¬å›æ•°é™åˆ¶ç­‰å‚æ•°ï¼Œæå‡çŸ¥è¯†æ£€ç´¢çš„å‡†ç¡®æ€§å’Œç›¸å…³æ€§ã€‚

### ğŸ“ SDKä½¿ç”¨æ–¹æ³•

```python
graph.add_node(
    node_id="knowledge_search",
    module_type="knowledgesSearch",
    position={"x": 300, "y": 200},
    inputs={
        # åŸºç¡€é…ç½®
        "text": "{{userChatInput}}",         # æœç´¢æ–‡æœ¬ï¼ˆå˜é‡å¼•ç”¨ï¼‰
        "datasets": ["kb_001", "kb_002"], # å…³è”çš„çŸ¥è¯†åº“IDåˆ—è¡¨
        
        # æ£€ç´¢å‚æ•°ä¼˜åŒ–
        "similarity": 0.2,               # ç›¸ä¼¼åº¦é˜ˆå€¼ (0-1)
        "vectorSimilarWeight": 1.0,      # å‘é‡ç›¸ä¼¼åº¦æƒé‡ (0-1)
        "topK": 20,                      # å¬å›æ•°é‡ (0-100)
        
        # é‡æ’åºé…ç½®ï¼ˆå¯é€‰ï¼‰
        "enableRerank": False,           # æ˜¯å¦å¼€å¯é‡æ’åº
        "rerankModelType": "oneapi-xinference:bce-rerank",  # é‡æ’åºæ¨¡å‹
        "rerankTopK": 10                 # é‡æ’åºå¬å›æ•° (0-20)
    }
)
```

### ğŸ”¶ å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | å¿…å¡« | èŒƒå›´ | è¯´æ˜ |
|-------|------|-------|------|------|------|
| `text` | string | `""` | âœ… | - | æœç´¢è¾“å…¥æ–‡æœ¬ï¼ˆæ”¯æŒå˜é‡å¼•ç”¨ï¼‰ |
| `datasets` | array | `[]` | âœ… | - | å…³è”çš„çŸ¥è¯†åº“IDåˆ—è¡¨ |
| `similarity` | number | `0.2` | âŒ | 0-1 | ç›¸ä¼¼åº¦é˜ˆå€¼ï¼Œä½äºæ­¤å€¼çš„ç»“æœå°†è¢«è¿‡æ»¤ |
| `vectorSimilarWeight` | number | `1.0` | âŒ | 0-1 | å‘é‡ç›¸ä¼¼åº¦æƒé‡ï¼ˆ1-æ­¤å€¼ä¸ºå…³é”®è¯æƒé‡ï¼‰ |
| `topK` | number | `20` | âŒ | 0-100 | å¬å›çš„ç›¸å…³åˆ‡ç‰‡æ•°é‡ |
| `enableRerank` | boolean | `False` | âŒ | - | æ˜¯å¦å¯ç”¨é‡æ’åºæ¨¡å‹ï¼ˆæ¶ˆè€—æ›´å¤šèµ„æºï¼‰ |
| `rerankModelType` | string | `"oneapi-xinference:bce-rerank"` | âŒ | - | é‡æ’åºæ¨¡å‹ç±»å‹ |
| `rerankTopK` | number | `10` | âŒ | 0-20 | é‡æ’åºåçš„å¬å›æ•°é‡ |

### ğŸ”· è¾“å‡ºå˜é‡ï¼ˆå¯åœ¨åç»­æ¨¡å—ä¸­å¼•ç”¨ï¼‰

| å˜é‡å | ç±»å‹ | è¯´æ˜ |
|-------|------|------|
| `{{isEmpty}}` | boolean | æœªæœç´¢åˆ°ç›¸å…³çŸ¥è¯†æ—¶ä¸ºtrue |
| `{{unEmpty}}` | boolean | æœç´¢åˆ°ç›¸å…³çŸ¥è¯†æ—¶ä¸ºtrue |  
| `{{quoteQA}}` | search | çŸ¥è¯†åº“æœç´¢ç»“æœæ•°ç»„ |
| `{{finish}}` | boolean | æ¨¡å—è¿è¡Œå®Œæˆæ ‡å¿— |

### âœ… ä½¿ç”¨è§„åˆ™ä¸ç‰¹ç‚¹

- **çŸ¥è¯†åº“å¿…å¡«**ï¼šå¿…é¡»æŒ‡å®š `datasets` å…³è”çš„çŸ¥è¯†åº“
- **åˆ†æ”¯æ§åˆ¶**ï¼šé€šè¿‡ `isEmpty`/`unEmpty` å®ç°æœç´¢ç»“æœåˆ†æ”¯å¤„ç†
- **å‚æ•°è°ƒä¼˜**ï¼šç›¸ä¼¼åº¦é˜ˆå€¼å’Œå¬å›æ•°å¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´
- **é‡æ’åºæƒè¡¡**ï¼šé‡æ’åºæå‡ç²¾åº¦ä½†æ¶ˆè€—æ›´å¤šèµ„æºï¼Œéœ€è°¨æ…å¼€å¯

### ğŸ§  å¸¸ç”¨é…ç½®ç¤ºä¾‹

```python
# ç¤ºä¾‹1ï¼šåŸºç¡€çŸ¥è¯†åº“æœç´¢
graph.add_node(
    node_id="kb_search", 
    module_type="knowledgesSearch",
    position={"x": 400, "y": 200},
    inputs={
        "text": "{{userChatInput}}",
        "datasets": ["customer_service_kb"]
    }
)

# ç¤ºä¾‹2ï¼šé«˜ç²¾åº¦æœç´¢ï¼ˆå¼€å¯é‡æ’åºï¼‰
graph.add_node(
    node_id="precise_search",
    module_type="knowledgesSearch",
    position={"x": 500, "y": 300},
    inputs={
        "text": "{{questionText}}",
        "datasets": ["legal_kb", "policy_kb"],
        "similarity": 0.3,
        "topK": 15,
        "enableRerank": True,
        "rerankTopK": 5
    }
)

# ç¤ºä¾‹3ï¼šæ··åˆæ£€ç´¢ï¼ˆå…³é”®è¯+å‘é‡ï¼‰
graph.add_node(
    node_id="hybrid_search",
    module_type="knowledgesSearch", 
    position={"x": 600, "y": 400},
    inputs={
        "text": "{{searchQuery}}",
        "datasets": ["product_kb"],
        "vectorSimilarWeight": 0.7,  # 70%å‘é‡ + 30%å…³é”®è¯
        "similarity": 0.25,
        "topK": 30
    }
)
```

---

## 6. é€šç”¨æ–‡æ¡£è§£æï¼ˆpdf2mdï¼‰
### ğŸ“Œ æ¨¡å—åŠŸèƒ½è¯´æ˜
è¯¥æ¨¡å—ç”¨äºå°†å„ç§é€šç”¨æ–‡æ¡£æ ¼å¼ï¼ˆå¦‚ PDFã€Word ç­‰ï¼‰è§£æå¹¶è½¬æ¢æˆ Markdown æ ¼å¼æ–‡æœ¬ï¼Œæ–¹ä¾¿åç»­æ–‡æœ¬å¤„ç†ã€å±•ç¤ºå’Œæ™ºèƒ½åˆ†æã€‚

### ğŸ“ SDKä½¿ç”¨æ–¹æ³•

```python
graph.add_node(
    node_id="doc_parser",
    module_type="pdf2md",
    position={"x": 400, "y": 300},
    inputs={
        # æ–‡æ¡£è¾“å…¥
        "files": "{{uploadedFiles}}",    # å¾…è§£æçš„æ–‡æ¡£æ–‡ä»¶ï¼ˆå˜é‡å¼•ç”¨ï¼‰
        
        # æ¨¡å‹é€‰æ‹©
        "pdf2mdType": "general"          # è§£ææ¨¡å‹ç±»å‹
    }
)
```

### ğŸ”¶ å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | å¿…å¡« | è¯´æ˜ |
|-------|------|-------|------|------|
| `files` | file | - | âœ… | å¾…è§£æçš„æ–‡æ¡£æ–‡ä»¶ï¼ˆæ”¯æŒå˜é‡å¼•ç”¨ï¼‰ |
| `pdf2mdType` | string | `"general"` | âœ… | è§£ææ¨¡å‹ç±»å‹ï¼Œå½±å“è½¬æ¢æ•ˆæœå’Œè¯†åˆ«ç²¾åº¦ |

### ğŸ”· è¾“å‡ºå˜é‡ï¼ˆå¯åœ¨åç»­æ¨¡å—ä¸­å¼•ç”¨ï¼‰

| å˜é‡å | ç±»å‹ | è¯´æ˜ |
|-------|------|------|
| `{{pdf2mdResult}}` | string | è½¬æ¢åçš„Markdownæ ¼å¼æ–‡æœ¬ |
| `{{success}}` | boolean | æ–‡æ¡£è§£ææˆåŠŸæ ‡å¿— |
| `{{failed}}` | boolean | æ–‡æ¡£è§£æå¤±è´¥æ ‡å¿— |
| `{{finish}}` | boolean | æ¨¡å—è¿è¡Œå®Œæˆæ ‡å¿— |

### âœ… ä½¿ç”¨è§„åˆ™ä¸ç‰¹ç‚¹

- **æ”¯æŒæ ¼å¼**ï¼šPDFã€Wordã€Excelç­‰å¤šç§æ–‡æ¡£æ ¼å¼
- **æ¨¡å‹é€‰æ‹©**ï¼šæ ¹æ®æ–‡æ¡£ç±»å‹é€‰æ‹©åˆé€‚çš„è§£ææ¨¡å‹
- **åˆ†æ”¯æ§åˆ¶**ï¼šé€šè¿‡ `success`/`failed` å®ç°è§£æç»“æœåˆ†æ”¯å¤„ç†
- **è¾“å‡ºæ ¼å¼**ï¼šç»Ÿä¸€è¾“å‡ºMarkdownæ ¼å¼ï¼Œä¾¿äºåç»­å¤„ç†

### ğŸ§  å¸¸ç”¨é…ç½®ç¤ºä¾‹

```python
# ç¤ºä¾‹1ï¼šåŸºç¡€æ–‡æ¡£è§£æ
graph.add_node(
    node_id="parse_doc",
    module_type="pdf2md",
    position={"x": 300, "y": 200},
    inputs={
        "files": "{{userUploadedFiles}}",
        "pdf2mdType": "general"
    }
)

# ç¤ºä¾‹2ï¼šè§£æç»“æœåˆ†æ”¯å¤„ç†
# æˆåŠŸåˆ†æ”¯
graph.add_node(
    node_id="process_success",
    module_type="aiChat",
    position={"x": 500, "y": 150},
    inputs={
        "text": "è¯·åˆ†æä»¥ä¸‹æ–‡æ¡£å†…å®¹ï¼š{{pdf2mdResult}}",
        "model": "glm-4-airx"
    }
)

# å¤±è´¥åˆ†æ”¯  
graph.add_node(
    node_id="handle_failure",
    module_type="confirmreply",
    position={"x": 500, "y": 250},
    inputs={
        "text": "æ–‡æ¡£è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡æ¡£æ ¼å¼æˆ–é‡æ–°ä¸Šä¼ ",
        "stream": True
    }
)

# æ·»åŠ è¿æ¥è¾¹
graph.add_edge("parse_doc", "process_success", "success", "switchAny")
graph.add_edge("parse_doc", "handle_failure", "failed", "switchAny")
```

## 7. æ·»åŠ è®°å¿†å˜é‡ï¼ˆaddMemoryVariableï¼‰

### ğŸ“Œ æ¨¡å—åŠŸèƒ½è¯´æ˜
è¯¥æ¨¡å—ç”¨äºå°†æŸä¸ªå˜é‡å€¼å­˜å‚¨ä¸ºæ™ºèƒ½ä½“çš„è®°å¿†å˜é‡ï¼Œä¾›åç»­æµç¨‹ä¸­å…¶ä»–æ¨¡å—é€šè¿‡ `{{å˜é‡å}}` çš„å½¢å¼å¼•ç”¨ï¼Œå®ç°è·¨æ¨¡å—å…±äº«ä¿¡æ¯ã€ä¸Šä¸‹æ–‡è®°å¿†ã€åŠ¨æ€å¼•ç”¨ç­‰åŠŸèƒ½ã€‚
é€‚ç”¨äºåœºæ™¯å¦‚ï¼šè®°å½•ç”¨æˆ·åé¦ˆã€æŠ½å–ç»“æœä¸­é—´å˜é‡ã€ä¿å­˜æ–‡ä»¶/å›¾ç‰‡ç­‰ç»“æœï¼Œç”¨äºåç»­æ¨¡å‹å¤„ç†æˆ–å“åº”ç”Ÿæˆã€‚

### ğŸ“ SDKä½¿ç”¨æ–¹æ³•

```python
# åŸºç¡€ç”¨æ³•ï¼šå•ä¸ªè®°å¿†å˜é‡
memory_variable_inputs = {}
memory_variable_inputs["question"] = "{{answerText}}"

[
    {
        "key": "question",
        "value": "{{answerText}}",
        "value_type": "text"
    },
    {
        "key": "feedback",
        "value": "{{aireply}}",
        "value_type": "text"
    }
]


graph.add_node(
    node_id="addMemoryVariable1",
    module_type="addMemoryVariable",
    position={"x": 1500, "y": 300},
    inputs=memory_variable_inputs
)

# é«˜çº§ç”¨æ³•ï¼šå¤šä¸ªè®°å¿†å˜é‡
graph.add_node(
    node_id="save_multiple",
    module_type="addMemoryVariable", 
    position={"x": 500, "y": 200},
    inputs={
        "user_question": "{{userChatInput}}",
        "ai_answer": "{{answerText}}",
        "uploaded_file": "{{files}}",
        "user_image": "{{images}}",
        "search_result": "{{quoteQA}}"
    }
)
```

### ğŸ”¶ æ”¯æŒçš„ValueTypeç±»å‹

`addMemoryVariable` æ¨¡å—æ”¯æŒä»¥ä¸‹å›ºå®šçš„æ•°æ®ç±»å‹ï¼š

| ValueType | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|-----------|------|----------|
| `string` | æ–‡æœ¬å­—ç¬¦ä¸² | ç”¨æˆ·è¾“å…¥å†…å®¹ã€AIå›ç­”ã€è¯†åˆ«æ‘˜è¦ç­‰ |
| `boolean` | å¸ƒå°”å€¼ | æ˜¯å¦æˆåŠŸã€æ˜¯å¦é€‰æ‹©æŸé¡¹ã€å¼€å…³çŠ¶æ€ç­‰ |
| `file` | æ–‡æ¡£ä¿¡æ¯ | ä¸Šä¼ çš„PDFã€DOCã€Excelç­‰æ–‡ä»¶ |
| `image` | å›¾ç‰‡ä¿¡æ¯ | ä¸Šä¼ çš„å›¾ç‰‡èµ„æº |
| `search` | çŸ¥è¯†åº“æœç´¢ç»“æœ | çŸ¥è¯†åº“æ£€ç´¢è¿”å›çš„å†…å®¹ |
| `any` | ä»»æ„ç±»å‹ | åŠ¨æ€ç»“æ„æˆ–æœªçŸ¥ç±»å‹æ•°æ® |
### ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

```python
# ä¸åŒç±»å‹çš„è®°å¿†å˜é‡ç¤ºä¾‹
inputs = {
    "question": "{{answerText}}",        # stringç±»å‹ï¼ˆæ–‡æœ¬ï¼‰
    "user_file": "{{uploadedFile}}",     # fileç±»å‹ï¼ˆæ–‡ä»¶ï¼‰
    "user_image": "{{userPhoto}}",       # imageç±»å‹ï¼ˆå›¾ç‰‡ï¼‰
    "is_success": "{{result}}",          # booleanç±»å‹ï¼ˆå¸ƒå°”å€¼ï¼‰
    "kb_result": "{{searchResult}}",     # searchç±»å‹ï¼ˆçŸ¥è¯†åº“æœç´¢ï¼‰
    "config_data": "{{configuration}}"   # anyç±»å‹ï¼ˆä»»æ„ç±»å‹ï¼‰
}
```

### ğŸ”· è¾“å‡ºå˜é‡ï¼ˆå¯åœ¨åç»­æ¨¡å—ä¸­å¼•ç”¨ï¼‰

**æ— ç›´æ¥è¾“å‡º**ï¼Œä½†ä¼šåœ¨æ™ºèƒ½ä½“å…¨å±€æ³¨å†Œè®°å¿†å˜é‡ï¼š
- å˜é‡åå³ä¸º `inputs` ä¸­çš„key
- åç»­æ¨¡å—å¯é€šè¿‡ `{{å˜é‡å}}` å¼•ç”¨
- valueTypeä¼šæ ¹æ®å®é™…æ•°æ®å†…å®¹è‡ªåŠ¨ç¡®å®šç±»å‹


### å¸¸ç”¨é…ç½®ç¤ºä¾‹

```python
# ç¤ºä¾‹1ï¼šä¿å­˜AIå›ç­”ä¾›åç»­å¼•ç”¨
memory_variable_inputs = []
input_1 = {
    "key": "",
    "value_type": ""
}

# è‹¥éœ€è¦å¤šå˜é‡ï¼Œä»¥æ­¤ç±»æ¨
# input_2 = {
#    "key": "",
#    "value_type": ""
# }

memory_variable_inputs.append(input_1)
# memory_variable_inputs.append(input_2) 

graph.add_node(
    node_id="addMemoryVariable1",
    module_type="addMemoryVariable",
    position={"x": 1500, "y": 300},
    inputs=memory_variable_inputs
)

```

---

## å®Œæ•´å·¥ä½œæµç¤ºä¾‹

```python
from src.autoagentsai.graph.FlowGraph import FlowGraph

# åˆ›å»ºFlowGraphå®ä¾‹
graph = FlowGraph(
    personal_auth_key="your_auth_key",
    personal_auth_secret="your_auth_secret"
)

# 1. ç”¨æˆ·è¾“å…¥
graph.add_node(
    node_id="user_input",
    module_type="questionInput",
    position={"x": 100, "y": 100},
    inputs={
        "inputText": True,
        "uploadFile": False
    }
)

# 2. AIå¤„ç†
graph.add_node(
    node_id="ai_chat",
    module_type="aiChat",
    position={"x": 300, "y": 100},
    inputs={
        "model": "glm-4-airx",
        "text": "{{userChatInput}}",
        "temperature": 0.1,
        "stream": True
    }
)

# 3. ä¿å­˜è®°å¿†å˜é‡
graph.add_node(
    node_id="save_memory",
    module_type="addMemoryVariable",
    position={"x": 500, "y": 100},
    inputs={
        "question": "{{userChatInput}}",  # stringç±»å‹ï¼ˆæ–‡æœ¬ï¼‰
        "ai_answer": "{{answerText}}"     # stringç±»å‹ï¼ˆæ–‡æœ¬ï¼‰
    }
)

# 4. ç¡®è®¤å›å¤
graph.add_node(
    node_id="confirm_reply",
    module_type="confirmreply",
    position={"x": 700, "y": 100},
    inputs={
        "text": "å·²ä¿å­˜é—®é¢˜ï¼š{{question}} å’Œå›ç­”ï¼š{{ai_answer}}",
        "stream": True
    }
)

# æ·»åŠ è¿æ¥è¾¹
graph.add_edge("user_input", "ai_chat", "finish", "switchAny")
graph.add_edge("ai_chat", "save_memory", "finish", "switchAny")
graph.add_edge("save_memory", "confirm_reply", "finish", "switchAny")

# ç¼–è¯‘å’Œéƒ¨ç½²
graph.compile(
    name="æ™ºèƒ½é—®ç­”åŠ©æ‰‹",
    intro="å…·æœ‰è®°å¿†åŠŸèƒ½çš„æ™ºèƒ½é—®ç­”åŠ©æ‰‹",
    category="å¯¹è¯å·¥å…·"
)
```
